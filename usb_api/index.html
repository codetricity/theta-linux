


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Configure Linux computers like the Jetson Nano to stream and use RICOH THETA USB API">
      
      
      
        <meta name="author" content="Oppkey">
      
      <link rel="shortcut icon" href="../images/logo-white.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.9">
    
    
      
        <title>USB API - RICOH THETA Development on Linux</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.36ee6aaa.min.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/palette.83bccb1f.min.css">
      
      
        
        
        <meta name="theme-color" content="#8bc34a">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
        
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-73311422-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview")})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="light-green" data-md-color-accent="lime">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#overview" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="RICOH THETA Development on Linux" class="md-header-nav__button md-logo" aria-label="RICOH THETA Development on Linux">
      
  <img src="../images/logo-white.png" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            RICOH THETA Development on Linux
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              USB API
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="RICOH THETA Development on Linux" class="md-nav__button md-logo" aria-label="RICOH THETA Development on Linux">
      
  <img src="../images/logo-white.png" alt="logo">

    </a>
    RICOH THETA Development on Linux
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../equipment/" title="Equipment" class="md-nav__link">
      Equipment
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../software/" title="Software" class="md-nav__link">
      Software
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../demos/" title="Demos" class="md-nav__link">
      Demos
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        USB API
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="USB API" class="md-nav__link md-nav__link--active">
      USB API
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
    <nav class="md-nav" aria-label="Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#advantages" class="md-nav__link">
    Advantages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardware-and-os" class="md-nav__link">
    Hardware and OS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mtp-software" class="md-nav__link">
    MTP software
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#libptp-and-ptpcam" class="md-nav__link">
    libptp and ptpcam
  </a>
  
    <nav class="md-nav" aria-label="libptp and ptpcam">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#download-libptp-source" class="md-nav__link">
    Download libptp source
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-libptp" class="md-nav__link">
    build libptp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-libusb-dev" class="md-nav__link">
    install libusb-dev
  </a>
  
    <nav class="md-nav" aria-label="install libusb-dev">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#for-raspberry-pi" class="md-nav__link">
    For Raspberry Pi
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-libptp" class="md-nav__link">
    install libptp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-usrlocallib-in-library-path" class="md-nav__link">
    set /usr/local/lib in library path
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-ldconfig" class="md-nav__link">
    run ldconfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-ptpcam" class="md-nav__link">
    Test ptpcam
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fix-problem-with-libptp-response" class="md-nav__link">
    Fix problem with libptp response
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-usb-api-with-ptpcam-libptp" class="md-nav__link">
    Using USB API with ptpcam (libptp)
  </a>
  
    <nav class="md-nav" aria-label="Using USB API with ptpcam (libptp)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-ptpcam-response-again" class="md-nav__link">
    test ptpcam response again
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-camera-to-live-streaming-mode" class="md-nav__link">
    Set camera to live streaming mode
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wake-camera-from-sleep" class="md-nav__link">
    Wake Camera From Sleep
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-camera-to-sleep" class="md-nav__link">
    Put camera to sleep
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#auto-power-off-delay" class="md-nav__link">
    Auto Power Off Delay
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shutdown-camera" class="md-nav__link">
    Shutdown Camera
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-camera-in-still-image-mode" class="md-nav__link">
    Put Camera in Still Image Mode
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-video-capture" class="md-nav__link">
    Start Video Capture
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-raw-ptp-commands" class="md-nav__link">
    Using Raw PTP Commands
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-multiple-cameras-with-ptpcam" class="md-nav__link">
    Using Multiple Cameras with ptpcam
  </a>
  
    <nav class="md-nav" aria-label="Using Multiple Cameras with ptpcam">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-environment" class="md-nav__link">
    Test Environment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-with-two-cameras-in-streaming" class="md-nav__link">
    Test with Two Cameras in Streaming
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-ways-to-grab-device-id" class="md-nav__link">
    Other Ways to Grab Device ID
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gphoto2" class="md-nav__link">
    gphoto2
  </a>
  
    <nav class="md-nav" aria-label="gphoto2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#command-line" class="md-nav__link">
    Command Line
  </a>
  
    <nav class="md-nav" aria-label="Command Line">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fixing-command-line-error-could-not-claim-the-usb-device" class="md-nav__link">
    Fixing Command Line Error - Could not claim the USB device
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#removing-gvfs-backend-permanently" class="md-nav__link">
    Removing gvfs-backend permanently
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-camera-mode-still-image-video-streaming" class="md-nav__link">
    Check Camera Mode (still image, video, streaming)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-to-video-mode" class="md-nav__link">
    set to video mode
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-video" class="md-nav__link">
    start video
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stop-video" class="md-nav__link">
    stop video
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-video-and-stop-after-specified-time" class="md-nav__link">
    start video and stop after specified time
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python-bindings" class="md-nav__link">
    Python bindings
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../camera/" title="Camera" class="md-nav__link">
      Camera
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../help/" title="Help" class="md-nav__link">
      Help
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../meetup/" title="Meetup Archive" class="md-nav__link">
      Meetup Archive
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
    <nav class="md-nav" aria-label="Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#advantages" class="md-nav__link">
    Advantages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardware-and-os" class="md-nav__link">
    Hardware and OS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mtp-software" class="md-nav__link">
    MTP software
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#libptp-and-ptpcam" class="md-nav__link">
    libptp and ptpcam
  </a>
  
    <nav class="md-nav" aria-label="libptp and ptpcam">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#download-libptp-source" class="md-nav__link">
    Download libptp source
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-libptp" class="md-nav__link">
    build libptp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-libusb-dev" class="md-nav__link">
    install libusb-dev
  </a>
  
    <nav class="md-nav" aria-label="install libusb-dev">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#for-raspberry-pi" class="md-nav__link">
    For Raspberry Pi
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-libptp" class="md-nav__link">
    install libptp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-usrlocallib-in-library-path" class="md-nav__link">
    set /usr/local/lib in library path
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-ldconfig" class="md-nav__link">
    run ldconfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-ptpcam" class="md-nav__link">
    Test ptpcam
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fix-problem-with-libptp-response" class="md-nav__link">
    Fix problem with libptp response
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-usb-api-with-ptpcam-libptp" class="md-nav__link">
    Using USB API with ptpcam (libptp)
  </a>
  
    <nav class="md-nav" aria-label="Using USB API with ptpcam (libptp)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-ptpcam-response-again" class="md-nav__link">
    test ptpcam response again
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-camera-to-live-streaming-mode" class="md-nav__link">
    Set camera to live streaming mode
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wake-camera-from-sleep" class="md-nav__link">
    Wake Camera From Sleep
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-camera-to-sleep" class="md-nav__link">
    Put camera to sleep
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#auto-power-off-delay" class="md-nav__link">
    Auto Power Off Delay
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shutdown-camera" class="md-nav__link">
    Shutdown Camera
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-camera-in-still-image-mode" class="md-nav__link">
    Put Camera in Still Image Mode
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-video-capture" class="md-nav__link">
    Start Video Capture
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-raw-ptp-commands" class="md-nav__link">
    Using Raw PTP Commands
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-multiple-cameras-with-ptpcam" class="md-nav__link">
    Using Multiple Cameras with ptpcam
  </a>
  
    <nav class="md-nav" aria-label="Using Multiple Cameras with ptpcam">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-environment" class="md-nav__link">
    Test Environment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-with-two-cameras-in-streaming" class="md-nav__link">
    Test with Two Cameras in Streaming
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-ways-to-grab-device-id" class="md-nav__link">
    Other Ways to Grab Device ID
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gphoto2" class="md-nav__link">
    gphoto2
  </a>
  
    <nav class="md-nav" aria-label="gphoto2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#command-line" class="md-nav__link">
    Command Line
  </a>
  
    <nav class="md-nav" aria-label="Command Line">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fixing-command-line-error-could-not-claim-the-usb-device" class="md-nav__link">
    Fixing Command Line Error - Could not claim the USB device
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#removing-gvfs-backend-permanently" class="md-nav__link">
    Removing gvfs-backend permanently
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-camera-mode-still-image-video-streaming" class="md-nav__link">
    Check Camera Mode (still image, video, streaming)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-to-video-mode" class="md-nav__link">
    set to video mode
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-video" class="md-nav__link">
    start video
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stop-video" class="md-nav__link">
    stop video
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-video-and-stop-after-specified-time" class="md-nav__link">
    start video and stop after specified time
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python-bindings" class="md-nav__link">
    Python bindings
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                  <h1>USB API</h1>
                
                <h2 id="overview">Overview</h2>
<p>RICOH THETA cameras can be controlled and powered
indefinitely over a USB cable using the
<a href="https://api.ricoh/docs/theta-usb-api/">THETA USB API</a>.
This is an extension of Media Transfer Protocol (MTP).
Any library or application that uses MTP can access
the camera.</p>
<p>This document explains the most common applications,
libraries and techniques to use the 
RICOH THETA USB API from Linux.</p>
<h3 id="advantages">Advantages</h3>
<p>The USB API has the following advantages over the 
Wi-Fi API:</p>
<ul>
<li>wake camera from sleep</li>
<li>put camera to sleep</li>
<li>power camer off</li>
<li>switch to live streaming mode</li>
<li>switch from live streaming mode to still image or video mode</li>
<li>theoretical faster transfer speed with USB 3.0 (for the Z1) or USB 2.0
for the V and other models. In actual use, it appears that the USB
does transfer faster than Wi-Fi in most cases as there is usually Wi-Fi
signal interference or degradation.</li>
<li>it is possible to use an unsupported workaround to turn the 
camera on over the USB cable. This technique doesn't use the
USB API and is not supported by RICOH. The technique is
explained in the <a href="../camera/">camera section</a>.</li>
</ul>
<h3 id="hardware-and-os">Hardware and OS</h3>
<p>We tested the USB API on the following platforms:</p>
<ul>
<li>x86 on Ubuntu 20.04.  In the past, we used 18.04, 16.04, and 14.04.</li>
<li>NVIDIA Jetson Nano with JetPack 4.4 (Ubuntu 18.04).  Othere versions of hardware and software should work.</li>
<li>Raspberry Pi 3 with Raspian 10, buster.  Any version and any model should work.
Note that the Rasbperry Pi 3 and earlier models cannot stream the THETA over
a USB cable.</li>
</ul>
<h3 id="mtp-software">MTP software</h3>
<p>This document covers two different strategies:</p>
<ol>
<li>libptp - either as library or with command line ptpcam</li>
<li>gphoto2 - command line and Python bindings to library</li>
</ol>
<p>The most common technique is to use the command line program
of libptp called ptpcam.  You can put ptpcam in a bash
shell script or run a system process from the language
you are using. For example, in Python, you can use the 
<a href="https://docs.python.org/3/library/subprocess.html">subprocess</a> module.</p>
<p>In Dart, you can use the <a href="https://api.dart.dev/stable/2.9.3/dart-io/Process-class.html">Process class</a>. I am using the <a href="https://pub.dev/packages/process_run">process_run</a> package.</p>
<p>As a demonstration of the USB API, I put a GUI wrapper around ptpcam
using Flutter and Dart.</p>
<p><img alt="usb api flutter" src="../images/usb_api/usb_api_flutter_1.gif" /></p>
<p>The next demo shows a common use of putting the camera to sleep
and waking it up.</p>
<p><img alt="usb" src="../images/usb_api/sleep.gif" /></p>
<p>There are several workarounds and fixes that we're using.
Feel free to ask questions.</p>
<h2 id="libptp-and-ptpcam">libptp and ptpcam</h2>
<p><a href="http://libptp.sourceforge.net/">libptp2</a> builds on <a href="https://github.com/libusb/libusb">libusb</a>. The latest version is 2-1.2.0, which was last updated on 2016-01-12.</p>
<p>The package builds against an older version of libusb, not the current
version that ships with Ubuntu and Raspian.  To get around this, you can
either install an older version of libusb from source or install
<a href="https://github.com/libusb/libusb-compat-0.1">libusb-compat-0.1</a> in addition
to libusb-1xx-dev. </p>
<p>Do not install libusb-compat-0.1 and libusb-0.1x on the same system.  Certain Linux distributions such
as ArchLinux/Manjaro have <a href="https://www.archlinux.org/packages/extra/x86_64/libusb-compat/">packages for libusb-compat</a>.</p>
<p>For Ubuntu 20.04 and 18.04 (JetPack 4.4), I was able to build the package
with libusb-dev.</p>
<p>For Raspian 10 buster, I used the source code for libusb-compat.</p>
<p>As there are many steps and possible places where you may get stuck
feel free to post a question in our 
<a href="https://community.theta360.guide/t/live-streaming-over-usb-on-ubuntu-and-linux-nvidia-jetson/4359?u=craig">forum</a>.</p>
<h3 id="download-libptp-source">Download libptp source</h3>
<p><a href="https://sourceforge.net/projects/libptp/">libptp - Picture Transfer Protocol lib</a></p>
<p>Get the newest version, which is 2-1.2 right now.</p>
<p><img alt="libptp source download" src="../images/usb_api/01_sourceforge_download.png" /></p>
<h3 id="build-libptp">build libptp</h3>
<pre><code class="bash">$ ./configure
$ make
</code></pre>

<p>If you have a build error when compiling libusb, you may need to install the 
development libraries for libusb.</p>
<p><img alt="libptp configuration error" src="../images/usb_api/02_libptp_configure_error.png" /></p>
<h3 id="install-libusb-dev">install libusb-dev</h3>
<p>For Ubuntu 18.04, 20.04 on x86 and JetPack 4.4 on Nano.</p>
<pre><code class="bash">$ sudo apt install libusb-dev
</code></pre>

<p>You may not need this step if you already have the libusb development
libraries installed.</p>
<p><img alt="libusb-dev install" src="../images/usb_api/03_libusb-dev_install.png" /></p>
<p>Example on x86 Ubuntu 20.04. </p>
<pre><code>$ sudo apt-get install libusb-dev
</code></pre>

<h4 id="for-raspberry-pi">For Raspberry Pi</h4>
<p>Version.</p>
<pre><code>Distributor ID: Raspbian
Description:    Raspbian GNU/Linux 10 (buster)
Release:    10
Codename:   buster
</code></pre>

<p>Get the libusb compatibility layer.</p>
<p><img alt="libusb-compat" src="../images/usb_api/libusb_compat.png" /></p>
<p><img alt="libusb-compat 0.15" src="../images/usb_api/libusb_compat_0.15.png" /></p>
<h3 id="install-libptp">install libptp</h3>
<pre><code class="bash">$ sudo make install
</code></pre>

<p><img alt="confirm build" src="../images/usb_api/04_build_succeeded.png" /></p>
<p>On x86 Ubuntu 20.04.</p>
<pre><code>$ tar zxvf libptp2-1.2.0.tar.gz 
libptp2-1.2.0/
</code></pre>

<p><code>./configure</code> ran with no problems<br />
<code>make</code> ran with no problems<br />
<code>sudo make install</code> ran with no problems  </p>
<pre><code>$ pwd
/usr/local/lib
$ ls -l libptp2.*
-rw-r--r-- 1 root root 352640 Aug 31 11:54 libptp2.a
-rwxr-xr-x 1 root root    941 Aug 31 11:54 libptp2.la
lrwxrwxrwx 1 root root     16 Aug 31 11:54 libptp2.so -&gt; libptp2.so.1.1.5
lrwxrwxrwx 1 root root     16 Aug 31 11:54 libptp2.so.1 -&gt; libptp2.so.1.1.5
-rwxr-xr-x 1 root root 249352 Aug 31 11:54 libptp2.so.1.1.5
</code></pre>

<h3 id="set-usrlocallib-in-library-path">set /usr/local/lib in library path</h3>
<p>The default location of the libptp install is <code>/usr/local/lib</code>.<br />
Make sure that this is in your library path.  If it isn't,
add it to a file such as <code>libc.conf</code> in <code>/etc/ld.so.conf/</code>.</p>
<pre><code>$ cd /etc/ld.so.conf.d/
$ ls
$ cat libc.conf
</code></pre>

<p><img alt="library path" src="../images/usb_api/05_confirm_usr_local.png" /></p>
<h3 id="run-ldconfig">run ldconfig</h3>
<p>Load the library configuration.</p>
<pre><code>$ sudo /sbin/ldconfig -v
</code></pre>

<p><img alt="ldconfig" src="../images/usb_api/06_ldconfig.png" /></p>
<p>On x86 Ubuntu 20.04.</p>
<pre><code>$ cd /etc/ld.so.conf.d/
$ l
fakeroot-x86_64-linux-gnu.conf  x86_64-linux-gnu.conf
i386-linux-gnu.conf             zz_i386-biarch-compat.conf
libc.conf
$ cat libc.conf 
# libc default configuration
/usr/local/lib
$ sudo ldconfig
$ 
</code></pre>

<h3 id="test-ptpcam">Test ptpcam</h3>
<p>Connect RICOH THETA to Jetson with a USB cable.</p>
<p>Version of 2-1.2 of libptp has a bug in it.  Although
ptpcam does take pictures and function normally,
you will
see an error about capture status.</p>
<p><img alt="capture status" src="../images/usb_api/07_capture_status_error.png" /></p>
<p>On x86 Ubuntu.</p>
<pre><code>$ ptpcam --info

Camera information
==================
Model: RICOH THETA Z1
  manufacturer: Ricoh Company, Ltd.
  serial number: '10010104'
  device version: 1.50.1
  extension ID: 0x00000006
  extension description: (null)
  extension version: 0x006e

$ cat /proc/cpuinfo 
processor   : 0
vendor_id   : GenuineIntel
cpu family  : 6
model       : 60
model name  : Intel(R) Pentium(R) CPU G3258 @ 3.20GHz
</code></pre>

<h3 id="fix-problem-with-libptp-response">Fix problem with libptp response</h3>
<p>Go to line 77 of <code>ptp.h</code> and change <code>PTP_USB_INT_PACKET_LEN</code> 
to <code>28</code>.</p>
<p><img alt="edit libptp source" src="../images/usb_api/08_edit_libptp_source.png" /></p>
<p>After modification, the code will look like this.</p>
<p><img alt="fixed source" src="../images/usb_api/09_libptp_source_fix.png" /></p>
<h2 id="using-usb-api-with-ptpcam-libptp">Using USB API with ptpcam (libptp)</h2>
<h3 id="test-ptpcam-response-again">test ptpcam response again</h3>
<p>Take a still image picture with <code>ptpcam --capture</code>.</p>
<p><img alt="results after fix" src="../images/usb_api/10_fix_results.png" /></p>
<h3 id="set-camera-to-live-streaming-mode">Set camera to live streaming mode</h3>
<p>Check on camera mode.</p>
<pre><code>$ ptpcam --show-property=0x5013
</code></pre>

<p>Set to live streaming mode.</p>
<pre><code>$ ptpcam --set-property=0x5013 --val=0x8005
</code></pre>

<p><img alt="set to live streaming mode" src="../images/usb_api/11_change_to_live_stream.png" /></p>
<p>Using the official 
<a href="https://api.ricoh/docs/theta-usb-api/property/still_capture_mode/">RICOH USB API documentation</a>, you can verify that
<code>0x8005</code> is live streaming mode.  The camera LED should show that
the THETA is in LIVE mode.</p>
<p><img alt="live led v" src="../images/usb_api/live_led.png" /></p>
<p>In our tests, the RICOH THETA Z1 could charge while streaming
over a USB 3.0 port (blue insert).  </p>
<p>After hours of streaming, the Z1 LED looks like this.</p>
<p><img alt="live led z1" src="../images/usb_api/live_z1.jpeg" /></p>
<p>The response codes are shown below.</p>
<pre><code>    0x0001 = single-shot shooting
    0x0003 = Interval shooting
    0x8002 = Movie shooting
    0x8003 = Interval composite shooting
    0x8004 = Multi bracket shooting
    0x8005 = Live streaming
    0x8006 = Interval shooting - tripod stabilizatio is off 
             (top/bottom correction and stitching optimized)
    0x8007 = Interval shooting - tripod stabilization is on
</code></pre>

<p>If you set the camera back to still image, single shot mode,
you will see this response.</p>
<pre><code class="bash">$ ptpcam --set-property=0x5013 --val=0x0001

Camera: RICOH THETA V
'Still Capture Mode' is set to: 0x8005 (-32763)
Changing property value to 0x0001 [(null)] succeeded.
</code></pre>

<h3 id="wake-camera-from-sleep">Wake Camera From Sleep</h3>
<p>In this test, I have the Z1 power off disabled.  I left the camera
in sleep mode overnight.  When I woke up in the morning,
I woke the Z1 up using an ssh session into the Jetson Nano and 
running this command.</p>
<pre><code class="bash">$ ptpcam --set-property=0xD80E --val=0x00

Camera: RICOH THETA Z1
'UNKNOWN' is set to: 1
Changing property value to 0x00 [(null)] succeeded.
</code></pre>

<p>I tested the camera with the info command.</p>
<pre><code class="bash">$ ptpcam --info

Camera information
==================
Model: RICOH THETA Z1
  manufacturer: Ricoh Company, Ltd.
  serial number: '10010104'
  device version: 1.50.1
  extension ID: 0x00000006
  extension description: (null)
  extension version: 0x006e
</code></pre>

<p>In my initial tests, I had to run the <code>info</code> command twice after
I woke the camera up from sleep. The first time, I could not
open the session.</p>
<p>I got this error.</p>
<pre><code class="bash">$ ptpcam --info
ERROR: Could not open session!
</code></pre>

<p>In the future, I'll run more tests using the
camera <a href="https://api.ricoh/docs/theta-usb-api/property/functional_mode/">FunctionalMode</a>
to check status.</p>
<p>This is another example with x86.  Initially, the camera is asleep.</p>
<pre><code>craig@cube:~$ ptpcam --info

Camera information
==================
ERROR: Could not open session!
craig@cube:~$ ptpcam --info

Camera information
==================
Model: RICOH THETA Z1
  manufacturer: Ricoh Company, Ltd.
  serial number: '10010104'
  device version: 1.50.1
  extension ID: 0x00000006
  extension description: (null)
  extension version: 0x006e

craig@cube:~$ ptpcam --set-property=0xd80e --val=0

Camera: RICOH THETA Z1
'UNKNOWN' is set to: 1
Changing property value to 0 [(null)] succeeded.
</code></pre>

<p>At this point, the camera is awake.</p>
<h3 id="put-camera-to-sleep">Put camera to sleep</h3>
<pre><code>$ ptpcam --set-property=0xd80e --val=0x01

Camera: RICOH THETA Z1
'UNKNOWN' is set to: 0
Changing property value to 0x01 [(null)] succeeded.
</code></pre>

<p>The camera is asleep.</p>
<h3 id="auto-power-off-delay">Auto Power Off Delay</h3>
<p>Disable auto power off.</p>
<p>$ ptpcam --set-property=0xd81b=0</p>
<p>Camera: RICOH THETA Z1
'UNKNOWN' is set to: 0</p>
<p>Verify that auto power off is disabled.</p>
<pre><code>$ ptpcam --show-property=0xd81b

Camera: RICOH THETA Z1
'UNKNOWN' is set to: 0
</code></pre>

<h3 id="shutdown-camera">Shutdown Camera</h3>
<p>This will completely power off the camera and put into lowest battery mode.</p>
<pre><code>$ ptpcam -R 0x1013
Camera: RICOH THETA Z1
Sending generic request: reqCode=0x1013, params=[0x00000000,0x00000000,0x00000000,0x00000000,0x00000000]
PTP: I/O error
ERROR: Could not close session!
</code></pre>

<p>To turn the camera back on, you must disconnect and then reconnect
the USB cable of the camera.  You can also replicate this process
in software.</p>
<h3 id="put-camera-in-still-image-mode">Put Camera in Still Image Mode</h3>
<p>You may want to take a detailed picture of the scene based on triggers
from the live stream.</p>
<p>To do this, you need to take the camera out of live streaming mode
and put it into still image mode.  In the example below, I
wrapped ptpcam in a script that explains the hexcode properties
of the mode settings.  This helps me with testing.</p>
<pre><code>$ ptpcam --set-property=0x5013 --val=0x0001

Camera: RICOH THETA Z1
'Still Capture Mode' is set to: [Normal]
Changing property value to 0x0001 [(null)] succeeded.

    0x0001 = single-shot shooting
    0x0003 = Interval shooting
    0x8002 = Movie shooting
    0x8003 = Interval composite shooting
    0x8004 = Multi bracket shooting
    0x8005 = Live streaming
    0x8006 = Interval shooting - tripod stabilizatio is off 
             (top/bottom correction and stitching optimized)
    0x8007 = Interval shooting - tripod stabilization is on
</code></pre>

<p>You can verify the mode of with 0x5013.</p>
<pre><code>$ ptpcam --show-property=0x5013

Camera: RICOH THETA Z1
'Still Capture Mode' is set to: [Normal]
</code></pre>

<p>Compare this with the result when the camera is in live streaming
mode.</p>
<pre><code>$ ptpcam --show-property=0x5013

Camera: RICOH THETA Z1
'Still Capture Mode' is set to: 0x8005 (-32763)

    0x0001 = single-shot shooting
    0x0003 = Interval shooting
    0x8002 = Movie shooting
    0x8003 = Interval composite shooting
    0x8004 = Multi bracket shooting
    0x8005 = Live streaming
    0x8006 = Interval shooting - tripod stabilizatio is off 
             (top/bottom correction and stitching optimized)
    0x8007 = Interval shooting - tripod stabilization is on
</code></pre>

<h3 id="start-video-capture">Start Video Capture</h3>
<p>This records video to file. </p>
<pre><code>ptpcam -R 0x101c,0,0,1
</code></pre>

<h3 id="using-raw-ptp-commands">Using Raw PTP Commands</h3>
<p>Get camera <a href="https://api.ricoh/docs/theta-usb-api/operation/get_device_info/">info</a>. </p>
<pre><code>$ ptpcam -R 0x1001
Camera: RICOH THETA Z1
Sending generic request: reqCode=0x1001, params=[0x00000000,0x00000000,0x00000000,0x00000000,0x00000000]
64 00 06 00 00 00 6e 00 00 00 00 33 00 00 00 01 - d.....n....3....
</code></pre>

<h2 id="using-multiple-cameras-with-ptpcam">Using Multiple Cameras with ptpcam</h2>
<h3 id="test-environment">Test Environment</h3>
<ul>
<li>Ubuntu 20.04 on x86</li>
<li>libptp and ptpcam.  compiled from source with patches.  v 2-1.2.0  (assuming you have this working.  If not please post again)</li>
<li>Camera with dev id 42 is Z1 with firmware 1.50.1</li>
<li>camera with dev id 41 is V with fimrware 3.40.1</li>
</ul>
<pre><code>craig@cube:~$ ptpcam --list-devices

Listing devices...
bus/dev vendorID/prodID device model
003/042 0x05CA/0x036D   RICOH THETA Z1
003/041 0x05CA/0x2714   RICOH THETA V

$ ptpcam --dev=042 --info

Camera information
==================
Model: RICOH THETA Z1
  manufacturer: Ricoh Company, Ltd.
  serial number: '10010104'
  device version: 1.50.1
  extension ID: 0x00000006
  extension description: (null)
  extension version: 0x006e

craig@cube:~$ ptpcam --dev=041 --info

Camera information
==================
Model: RICOH THETA V
  manufacturer: Ricoh Company, Ltd.
  serial number: '00105377'
  device version: 3.40.1
  extension ID: 0x00000006
  extension description: (null)
  extension version: 0x006e

craig@cube:~$ ptpcam --dev=041 --capture

Initiating captue...
Object added 0x00000226
Capture completed successfully!
craig@cube:~$ ptpcam --dev=042 --capture

Initiating captue...
Object added 0x00000011
Capture completed successfully!
</code></pre>

<p>Slightly more complex, list files:</p>
<pre><code>~$ ptpcam --dev=042 --list-files

Listing files...
Camera: RICOH THETA Z1
Handler:           Size:    Captured:       name:
0x0000000e:      9086912    2019-01-01 08:03    R0010001.JPG
0x0000000f:      7968843    2019-01-01 08:00    R0010002.JPG
0x00000010:      7990763    2019-01-01 08:01    R0010003.JPG
0x00000011:      8008310    2019-01-01 08:03    R0010004.JPG
</code></pre>

<p>I have several hundred pictures on the V, but it showed it.</p>
<pre><code>$ ptpcam --dev=041 --list-files

Listing files...
Camera: RICOH THETA V
Handler:           Size:    Captured:       name:
0x00000142:      4152882    2020-06-17 20:59    R0010273.JPG
0x00000143:      3979605    2020-06-17 21:03    R0010274.JPG
0x00000147:      4413502    2020-06-17 21:43    R0010277.JPG
...
</code></pre>

<h3 id="test-with-two-cameras-in-streaming">Test with Two Cameras in Streaming</h3>
<pre><code>$ ptpcam --dev=041 --set-property=0x5013 --val=0x8005

Camera: RICOH THETA V (bus 0, dev 41)
'Still Capture Mode' is set to: [Normal]
Changing property value to 0x8005 [(null)] succeeded.
craig@cube:~$ 

$ ptpcam --dev=042 --set-property=0x5013 --val=0x8005

Camera: RICOH THETA Z1 (bus 0, dev 42)
'Still Capture Mode' is set to: [Normal]
Changing property value to 0x8005 [(null)] succeeded.
</code></pre>

<p>At this stage, I now have two cameras streaming into the same devices.  I need to do more tests to manipulate both streams. </p>
<p>however, if your application is handing the stream and image processing already, then you should be good to go.</p>
<h3 id="other-ways-to-grab-device-id">Other Ways to Grab Device ID</h3>
<p>You can also grab the device ID with <code>lsusb</code> or libusb.</p>
<p><img alt="lsusb" src="../images/usb_api/lsusb.png" /></p>
<p>Compare the device IDs to <code>ptpcam --list-devices</code>.  The IDs should be the same.</p>
<p><img alt="list devices" src="../images/usb_api/list_devices.png" /></p>
<h2 id="gphoto2">gphoto2</h2>
<h3 id="command-line">Command Line</h3>
<h4 id="fixing-command-line-error-could-not-claim-the-usb-device">Fixing Command Line Error - Could not claim the USB device</h4>
<p>You may get this error.</p>
<pre><code class="bash">$ gphoto2 --capture-image

*** Error ***              
An error occurred in the io-library ('Could not claim the USB device'): Could not claim interface 0 (Device or resource busy). Make sure no other program (gvfs-gphoto2-volume-monitor) or kernel module (such as sdc2xx, stv680, spca50x) is using the device and you have read/write access to the device.
ERROR: Could not capture image.
ERROR: Could not capture.
*** Error (-53: 'Could not claim the USB device') ***       
</code></pre>

<p>Fix for current session is to kill gvfs-gphoto2-volume-monitor and gvfsd-gphoto2 spawner.</p>
<pre><code class="bash">
$ ps aux |grep gvfs
...
craig       2422  0.0  0.0 442504 13528 ?        Sl   08:19   0:00 /usr/libexec/gvfsd-gphoto2 --spawner :1.3 /org/gtk/gvfs/exec_spaw/1
...
craig       1969  0.0  0.0 249860 10032 ?        Ssl  08:19   0:00 /usr/libexec/gvfs-gphoto2-volume-monitor
...

$ kill 2422
$ kill 1969
$ gphoto2 --capture-image
New file is in location /store_00020001/DCIM/100RICOH/R0010376.JPG on the camera
$ 
</code></pre>

<h4 id="removing-gvfs-backend-permanently">Removing gvfs-backend permanently</h4>
<p>If you don't mount the THETA as a storage device with gphoto, you can remove gvfs-backend.  This is a workaround for the 
conflict when you use gphoto2 from the command line to talk to the THETA.</p>
<pre><code>$ sudo apt remove gvfs-backends
[sudo] password for craig: 
Reading package lists... Done
Building dependency tree       
</code></pre>

<p>Reboot to test. </p>
<p>After reboot. </p>
<pre><code>$ gphoto2 -l
There is 1 folder in folder '/'.                                               
 - store_00020001
There is 1 folder in folder '/store_00020001'.
 - DCIM
There are 2 folders in folder '/store_00020001/DCIM'.
 - 100RICOH
 - SingleLensShooting
There is 1 folder in folder '/store_00020001/DCIM/100RICOH'.
 - HDR07-22_18-13
There are 0 folders in folder '/store_00020001/DCIM/100RICOH/HDR07-22_18-13'.
There are 0 folders in folder '/store_00020001/DCIM/SingleLensShooting'.
</code></pre>

<p>It works!</p>
<h4 id="check-camera-mode-still-image-video-streaming">Check Camera Mode (still image, video, streaming)</h4>
<p><a href="https://api.ricoh/docs/theta-usb-api/property/still_capture_mode/">StillCaptureMode API reference</a></p>
<pre><code>$ gphoto2 --get-config=5013
Label: Still Capture Mode
Readonly: 0
Type: MENU
Current: 1
Choice: 0 1
Choice: 1 3
Choice: 2 32770
Choice: 3 32771
Choice: 4 32772
Choice: 5 32773
Choice: 6 32774
Choice: 7 32775
END
craig@craig-desktop:~$
</code></pre>

<h4 id="set-to-video-mode">set to video mode</h4>
<p>Using the <a href="https://api.ricoh/docs/theta-usb-api/property/still_capture_mode/">API reference</a>, we can see that video mode is hex <code>0x8002</code> or 32770 in base 10.</p>
<pre><code>$ gphoto2 --set-config=5013=32770
</code></pre>

<h4 id="start-video">start video</h4>
<pre><code>$ gphoto2 --set-config movie=1
</code></pre>

<h4 id="stop-video">stop video</h4>
<p>this tip contributed by <a href="https://community.theta360.guide/u/Hugues">hugues</a></p>
<pre><code>$ gphoto2 --set-config=/main/actions/opcode=0x1018,0xFFFFFFFF
</code></pre>

<h4 id="start-video-and-stop-after-specified-time">start video and stop after specified time</h4>
<pre><code>$ gphoto2 --set-config movie=1 --wait-event=2s --set-config movie=0 
</code></pre>

<h3 id="python-bindings">Python bindings</h3>
<p>From community member <a href="https://community.theta360.guide/u/mhenrie">mhenrie</a></p>
<p><a href="https://community.theta360.guide/t/using-usb-api-mtp-on-macos/4521/9">original post</a></p>
<pre><code class="python">&quot;&quot;&quot;
USB api for added performance over http

Theta api reference:
https://developers.theta360.com/en/docs/v2/usb_reference/

Unable to get mtp or ptp to connect to the camera; After some pain was able to get gphoto2 working
&quot;&quot;&quot;

import os
import time

import gphoto2 as gp

# Properties
SHUTTER_SPEED = 'd00f'
EXPOSURE_INDEX = '500f'
F_NUMBER = '5007'
AUDIO_VOLUME = '502c'
COLOR_TEMPERATURE = 'd813'
EXPOSURE_PROGRAM_MODE = '500e'

# milliseconds
TIMEOUT = 10
TIMEOUT_CAPTURE_DNG = 10000


def wait_for_event(camera, timeout=TIMEOUT, event_type=gp.GP_EVENT_TIMEOUT):
    &quot;&quot;&quot;
    Wait for event_type to to be triggered.
    :param camera:
    :param timeout:
    :param event_type:
    :return: event_data
    &quot;&quot;&quot;
    while True:
        _event_type, event_data = camera.wait_for_event(timeout)
        if _event_type == gp.GP_EVENT_TIMEOUT:
            return
        if _event_type == event_type:
            return event_data


def set_config_by_index(config, index):
    &quot;&quot;&quot;Set config using choice index&quot;&quot;&quot;
    value = config.get_choice(index)
    config.set_value(value)

    return config


# def list_files(camera, path='/'):
#     result = []
#     # get files
#     for name, value in camera.folder_list_files(path):
#         result.append(os.path.join(path, name))
#     # read folders
#     folders = []
#     for name, value in camera.folder_list_folders(path):
#         folders.append(name)
#     # recurse over subfolders
#     for name in folders:
#         result.extend(list_files(camera, os.path.join(path, name)))
#     return result
#
#
# def get_file_info(camera, path):
#     folder, name = os.path.split(path)
#     return camera.file_get_info(folder, name)


class CameraUsb(object):
    &quot;&quot;&quot;
    Define API for multiple exposure
    &quot;&quot;&quot;
    def __init__(self, verbose=False):
        self.verbose = verbose

        self.camera = gp.Camera()

        self.camera_config = None
        self.status_config = None
        self.other_config = None
        self.shutter_speed_config = None
        self.shutter_speed_options = []

    def init(self):
        &quot;&quot;&quot;
        Set manual exposure and other defaults
        :return: config
        &quot;&quot;&quot;
        try:
            self.camera_config = self.camera.get_config()
        except gp.GPhoto2Error:
            raise RuntimeError(&quot;Unable to connect to Camera&quot;)

        self.other_config = self.camera_config.get_child_by_name('other')

        # Manual/f-stop/iso
        exposure_program_mode = self.other_config.get_child_by_name(EXPOSURE_PROGRAM_MODE)
        if not exposure_program_mode.get_value() == '1':
            print('Setting camera to Manual exposure program')
            exposure_program_mode.set_value('1')
            self.camera.set_config(self.camera_config)
            wait_for_event(self.camera)

            # When switching exposure program, we need to refresh the configs
            self.camera_config = self.camera.get_config()
            self.other_config = self.camera_config.get_child_by_name('other')

        self.status_config = self.camera_config.get_child_by_name('status')

        self.shutter_speed_config = self.other_config.get_child_by_name(SHUTTER_SPEED)
        self.shutter_speed_options = [str(x) for x in self.shutter_speed_config.get_choices()]
        if len(self.shutter_speed_options) != 61:
            raise RuntimeError('Unble to determine shutter speed options; restart app')

        fstop = self.other_config.get_child_by_name(F_NUMBER)
        fstop.set_value('560')

        iso = self.other_config.get_child_by_name(EXPOSURE_INDEX)
        iso.set_value('80')

        self.camera.set_config(self.camera_config)
        wait_for_event(self.camera)

    def get_info(self):
        &quot;&quot;&quot;
        :return: Dict containing serialnumber, batterylevel, remainingpictures, etc
        &quot;&quot;&quot;
        if not self.camera_config:
            self.init()

        battery_level = self.status_config.get_child_by_name('batterylevel').get_value()
        # Convert '67%' to int
        battery_level = int(''.join([x for x in battery_level if x.isdigit()]))

        info = {'serialnumber': self.status_config.get_child_by_name('serialnumber').get_value(),
                'cameramodel': self.status_config.get_child_by_name('cameramodel').get_value(),
                'deviceversion': self.status_config.get_child_by_name('deviceversion').get_value(),
                'batterylevel': battery_level,
                'remainingpictures': int(self.camera.get_storageinfo()[0].freeimages)}
        return info

    def take_picture(self, shutter_speed_index=None, color_temperature=None, volume=None):
        &quot;&quot;&quot;
        Set camera options and take picture
        Blocking
        :param shutter_speed_index: int in range 0-60 (0 fastest shutter)
        :param color_temperature: in in range 2500-10000 by 100 increment
        :param volume: int in range 0-100
        :return: (jpg_path, dng_path)
        &quot;&quot;&quot;
        t1 = time.time()
        if not self.camera_config:
            self.init()

        if shutter_speed_index is not None:
            self.shutter_speed_config.set_value(self.shutter_speed_options[shutter_speed_index])

        if color_temperature is not None:
            self.other_config.get_child_by_name(COLOR_TEMPERATURE).set_value(color_temperature)

        if volume is not None:
            self.other_config.get_child_by_name(AUDIO_VOLUME).set_value(str(volume))

        self.camera.set_config(self.camera_config)
        # We need this even though no event is triggered
        wait_for_event(self.camera)

        gp_jpg_path = self.camera.capture(gp.GP_CAPTURE_IMAGE)

        gp_dng_path = wait_for_event(self.camera, timeout=TIMEOUT_CAPTURE_DNG, event_type=gp.GP_EVENT_FILE_ADDED)
        if not gp_dng_path:
            raise RuntimeError('Unable to copy DNG')

        jpg_path = os.path.join(gp_jpg_path.folder, gp_jpg_path.name)
        dng_path = os.path.join(gp_dng_path.folder, gp_dng_path.name)

        print('Capture took %0.03f sec' % (time.time() - t1, ))
        return jpg_path, dng_path

    def download_file(self, src_path, dst_path, delete=True):
        &quot;&quot;&quot;Copy the file from the camera src_path to local dst_path&quot;&quot;&quot;
        t1 = time.time()

        src_folder, src_name = os.path.split(src_path)
        src_file = self.camera.file_get(src_folder, src_name, gp.GP_FILE_TYPE_NORMAL)
        print('Download %s -&gt;\n\t%s' % (src_path, dst_path))
        src_file.save(dst_path)
        wait_for_event(self.camera)
        print('Download took %0.03f sec' % (time.time() - t1, ))

        if delete:
            t1 = time.time()
            print('Delete %s' % src_path)
            self.camera.file_delete(src_folder, src_name)
            wait_for_event(self.camera)
            print('Delete took %0.03f sec' % (time.time() - t1, ))


def _unittest():
    &quot;&quot;&quot;test a short exposure sequence&quot;&quot;&quot;
    # temporary directory
    dst_template = '/tmp/theta/capture.%04d.%s'

    t1 = time.time()
    camera = CameraUsb()

    camera.init()

    print(camera.get_info())

    frame = 1
    jpg_path, dng_path = camera.take_picture(0)
    print(jpg_path, dng_path)
    camera.download_file(dng_path, dst_template % (frame, 'dng'))
    frame += 1

    jpg_path, dng_path = camera.take_picture(24)
    print(jpg_path, dng_path)
    camera.download_file(dng_path, dst_template % (frame, 'dng'))
    frame += 1

    jpg_path, dng_path = camera.take_picture(42)
    print(jpg_path, dng_path)
    camera.download_file(dng_path, dst_template % (frame, 'dng'))
    frame += 1
    print('Done in %0.03f sec' % (time.time() - t1, ))


if __name__ == &quot;__main__&quot;:

    _unittest()


</code></pre>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../demos/" title="Demos" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Demos
              </div>
            </div>
          </a>
        
        
          <a href="../camera/" title="Camera" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Camera
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made by
        <a href="https://oppkey.com" target="_blank" rel="noopener">
          Oppkey
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/theta360developers" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://twitter.com/theta360dev" target="_blank" rel="noopener" title="twitter.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://www.facebook.com/theta360guide/" target="_blank" rel="noopener" title="www.facebook.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.df0def68.min.js"></script>
      <script src="../assets/javascripts/bundle.ba57d267.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.5eca75d3.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>