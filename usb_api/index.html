
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Configure Linux computers like the Jetson Nano to stream and use RICOH THETA USB API">
      
      
        <meta name="author" content="Oppkey">
      
      
      
        <link rel="prev" href="../examples/">
      
      
        <link rel="next" href="../camera/">
      
      
      <link rel="icon" href="../images/logo-white.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.31">
    
    
      
        <title>USB API - RICOH THETA Development on Linux</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-GKVKMSBLHK"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-GKVKMSBLHK",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-GKVKMSBLHK",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-green" data-md-color-accent="lime">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#overview" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="RICOH THETA Development on Linux" class="md-header__button md-logo" aria-label="RICOH THETA Development on Linux" data-md-component="logo">
      
  <img src="../images/logo-white.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            RICOH THETA Development on Linux
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              USB API
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="RICOH THETA Development on Linux" class="md-nav__button md-logo" aria-label="RICOH THETA Development on Linux" data-md-component="logo">
      
  <img src="../images/logo-white.png" alt="logo">

    </a>
    RICOH THETA Development on Linux
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../equipment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Equipment
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../software/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Software
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../demos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Demos
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Examples
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    USB API
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    USB API
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#advantages" class="md-nav__link">
    <span class="md-ellipsis">
      Advantages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardware-and-os" class="md-nav__link">
    <span class="md-ellipsis">
      Hardware and OS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#seeing-version-of-ubuntu" class="md-nav__link">
    <span class="md-ellipsis">
      Seeing Version of Ubuntu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-vesion-of-linux-tegra" class="md-nav__link">
    <span class="md-ellipsis">
      Getting Vesion of Linux Tegra
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mtp-software" class="md-nav__link">
    <span class="md-ellipsis">
      MTP software
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mtp-bindings" class="md-nav__link">
    <span class="md-ellipsis">
      MTP bindings
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#libptp-and-ptpcam" class="md-nav__link">
    <span class="md-ellipsis">
      libptp and ptpcam
    </span>
  </a>
  
    <nav class="md-nav" aria-label="libptp and ptpcam">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#download-libptp-source" class="md-nav__link">
    <span class="md-ellipsis">
      Download libptp source
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-libptp" class="md-nav__link">
    <span class="md-ellipsis">
      build libptp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-libusb-dev" class="md-nav__link">
    <span class="md-ellipsis">
      install libusb-dev
    </span>
  </a>
  
    <nav class="md-nav" aria-label="install libusb-dev">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#for-raspberry-pi" class="md-nav__link">
    <span class="md-ellipsis">
      For Raspberry Pi
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-libptp" class="md-nav__link">
    <span class="md-ellipsis">
      install libptp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-usrlocallib-in-library-path" class="md-nav__link">
    <span class="md-ellipsis">
      set /usr/local/lib in library path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-ldconfig" class="md-nav__link">
    <span class="md-ellipsis">
      run ldconfig
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-ptpcam" class="md-nav__link">
    <span class="md-ellipsis">
      Test ptpcam
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fix-problem-with-libptp-response" class="md-nav__link">
    <span class="md-ellipsis">
      Fix problem with libptp response
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-usb-api-with-ptpcam-libptp" class="md-nav__link">
    <span class="md-ellipsis">
      Using USB API with ptpcam (libptp)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using USB API with ptpcam (libptp)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-ptpcam-response-again" class="md-nav__link">
    <span class="md-ellipsis">
      test ptpcam response again
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-camera-to-live-streaming-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Set camera to live streaming mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wake-camera-from-sleep" class="md-nav__link">
    <span class="md-ellipsis">
      Wake Camera From Sleep
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-camera-to-sleep" class="md-nav__link">
    <span class="md-ellipsis">
      Put camera to sleep
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#auto-power-off-delay" class="md-nav__link">
    <span class="md-ellipsis">
      Auto Power Off Delay
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shutdown-camera" class="md-nav__link">
    <span class="md-ellipsis">
      Shutdown Camera
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-camera-in-still-image-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Put Camera in Still Image Mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-video-capture" class="md-nav__link">
    <span class="md-ellipsis">
      Start Video Capture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-raw-ptp-commands" class="md-nav__link">
    <span class="md-ellipsis">
      Using Raw PTP Commands
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-multiple-cameras-with-ptpcam" class="md-nav__link">
    <span class="md-ellipsis">
      Using Multiple Cameras with ptpcam
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using Multiple Cameras with ptpcam">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Test Environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-with-two-cameras-in-streaming" class="md-nav__link">
    <span class="md-ellipsis">
      Test with Two Cameras in Streaming
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-ways-to-grab-device-id" class="md-nav__link">
    <span class="md-ellipsis">
      Other Ways to Grab Device ID
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gphoto2" class="md-nav__link">
    <span class="md-ellipsis">
      gphoto2
    </span>
  </a>
  
    <nav class="md-nav" aria-label="gphoto2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#command-line" class="md-nav__link">
    <span class="md-ellipsis">
      Command Line
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Command Line">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fixing-command-line-error-could-not-claim-the-usb-device" class="md-nav__link">
    <span class="md-ellipsis">
      Fixing Command Line Error - Could not claim the USB device
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#removing-gvfs-backend-permanently" class="md-nav__link">
    <span class="md-ellipsis">
      Removing gvfs-backend permanently
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-camera-mode-still-image-video-streaming" class="md-nav__link">
    <span class="md-ellipsis">
      Check Camera Mode (still image, video, streaming)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unmount-camera" class="md-nav__link">
    <span class="md-ellipsis">
      unmount camera
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-to-video-mode" class="md-nav__link">
    <span class="md-ellipsis">
      set to video mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-video" class="md-nav__link">
    <span class="md-ellipsis">
      start video
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stop-video" class="md-nav__link">
    <span class="md-ellipsis">
      stop video
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-video-and-stop-after-specified-time" class="md-nav__link">
    <span class="md-ellipsis">
      start video and stop after specified time
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python-bindings" class="md-nav__link">
    <span class="md-ellipsis">
      Python bindings
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../camera/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Camera
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../optimization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Optimization
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../viewer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Image Viewer
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../help/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Help
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../meetup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Meetup Archive
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#advantages" class="md-nav__link">
    <span class="md-ellipsis">
      Advantages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardware-and-os" class="md-nav__link">
    <span class="md-ellipsis">
      Hardware and OS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#seeing-version-of-ubuntu" class="md-nav__link">
    <span class="md-ellipsis">
      Seeing Version of Ubuntu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-vesion-of-linux-tegra" class="md-nav__link">
    <span class="md-ellipsis">
      Getting Vesion of Linux Tegra
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mtp-software" class="md-nav__link">
    <span class="md-ellipsis">
      MTP software
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mtp-bindings" class="md-nav__link">
    <span class="md-ellipsis">
      MTP bindings
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#libptp-and-ptpcam" class="md-nav__link">
    <span class="md-ellipsis">
      libptp and ptpcam
    </span>
  </a>
  
    <nav class="md-nav" aria-label="libptp and ptpcam">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#download-libptp-source" class="md-nav__link">
    <span class="md-ellipsis">
      Download libptp source
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-libptp" class="md-nav__link">
    <span class="md-ellipsis">
      build libptp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-libusb-dev" class="md-nav__link">
    <span class="md-ellipsis">
      install libusb-dev
    </span>
  </a>
  
    <nav class="md-nav" aria-label="install libusb-dev">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#for-raspberry-pi" class="md-nav__link">
    <span class="md-ellipsis">
      For Raspberry Pi
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-libptp" class="md-nav__link">
    <span class="md-ellipsis">
      install libptp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-usrlocallib-in-library-path" class="md-nav__link">
    <span class="md-ellipsis">
      set /usr/local/lib in library path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-ldconfig" class="md-nav__link">
    <span class="md-ellipsis">
      run ldconfig
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-ptpcam" class="md-nav__link">
    <span class="md-ellipsis">
      Test ptpcam
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fix-problem-with-libptp-response" class="md-nav__link">
    <span class="md-ellipsis">
      Fix problem with libptp response
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-usb-api-with-ptpcam-libptp" class="md-nav__link">
    <span class="md-ellipsis">
      Using USB API with ptpcam (libptp)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using USB API with ptpcam (libptp)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-ptpcam-response-again" class="md-nav__link">
    <span class="md-ellipsis">
      test ptpcam response again
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-camera-to-live-streaming-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Set camera to live streaming mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wake-camera-from-sleep" class="md-nav__link">
    <span class="md-ellipsis">
      Wake Camera From Sleep
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-camera-to-sleep" class="md-nav__link">
    <span class="md-ellipsis">
      Put camera to sleep
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#auto-power-off-delay" class="md-nav__link">
    <span class="md-ellipsis">
      Auto Power Off Delay
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shutdown-camera" class="md-nav__link">
    <span class="md-ellipsis">
      Shutdown Camera
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-camera-in-still-image-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Put Camera in Still Image Mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-video-capture" class="md-nav__link">
    <span class="md-ellipsis">
      Start Video Capture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-raw-ptp-commands" class="md-nav__link">
    <span class="md-ellipsis">
      Using Raw PTP Commands
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-multiple-cameras-with-ptpcam" class="md-nav__link">
    <span class="md-ellipsis">
      Using Multiple Cameras with ptpcam
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using Multiple Cameras with ptpcam">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Test Environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-with-two-cameras-in-streaming" class="md-nav__link">
    <span class="md-ellipsis">
      Test with Two Cameras in Streaming
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-ways-to-grab-device-id" class="md-nav__link">
    <span class="md-ellipsis">
      Other Ways to Grab Device ID
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gphoto2" class="md-nav__link">
    <span class="md-ellipsis">
      gphoto2
    </span>
  </a>
  
    <nav class="md-nav" aria-label="gphoto2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#command-line" class="md-nav__link">
    <span class="md-ellipsis">
      Command Line
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Command Line">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fixing-command-line-error-could-not-claim-the-usb-device" class="md-nav__link">
    <span class="md-ellipsis">
      Fixing Command Line Error - Could not claim the USB device
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#removing-gvfs-backend-permanently" class="md-nav__link">
    <span class="md-ellipsis">
      Removing gvfs-backend permanently
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-camera-mode-still-image-video-streaming" class="md-nav__link">
    <span class="md-ellipsis">
      Check Camera Mode (still image, video, streaming)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unmount-camera" class="md-nav__link">
    <span class="md-ellipsis">
      unmount camera
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-to-video-mode" class="md-nav__link">
    <span class="md-ellipsis">
      set to video mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-video" class="md-nav__link">
    <span class="md-ellipsis">
      start video
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stop-video" class="md-nav__link">
    <span class="md-ellipsis">
      stop video
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-video-and-stop-after-specified-time" class="md-nav__link">
    <span class="md-ellipsis">
      start video and stop after specified time
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python-bindings" class="md-nav__link">
    <span class="md-ellipsis">
      Python bindings
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>USB API</h1>

<h2 id="overview">Overview</h2>
<p>RICOH THETA cameras can be controlled and powered
indefinitely over a USB cable using the
<a href="https://github.com/ricohapi/theta-api-specs/tree/main/theta-usb-api">THETA USB API</a>.
This is an extension of Media Transfer Protocol (MTP).
Any library or application that uses MTP can access
the camera.</p>
<p>This document explains the most common applications,
libraries and techniques to use the 
RICOH THETA USB API from Linux.</p>
<h3 id="advantages">Advantages</h3>
<p>The USB API has the following advantages over the 
Wi-Fi API:</p>
<ul>
<li>wake camera from sleep</li>
<li>put camera to sleep</li>
<li>power camer off</li>
<li>switch to live streaming mode</li>
<li>switch from live streaming mode to still image or video mode</li>
<li>theoretical faster transfer speed with USB 3.0 (for the Z1) or USB 2.0
for the V and other models. In actual use, it appears that the USB
does transfer faster than Wi-Fi in most cases as there is usually Wi-Fi
signal interference or degradation.</li>
<li>it is possible to use an unsupported workaround to turn the 
camera on over the USB cable. This technique doesn't use the
USB API and is not supported by RICOH. The technique is
explained in the <a href="../camera/">camera section</a>.</li>
</ul>
<h3 id="hardware-and-os">Hardware and OS</h3>
<p>We tested the USB API on the following platforms:</p>
<ul>
<li>x86 on Ubuntu 22.04.  In the past, we used 20.04, 18.04, 16.04, and 14.04.</li>
<li>NVIDIA Jetson Nano with JetPack 4.6.1 R32 revision 7.1 (Ubuntu 18.04).  Other versions of hardware and software should work.</li>
<li>Raspberry Pi 3 with Raspian 10, buster.  Any version and any model should work.
Note that the Rasbperry Pi 3 and earlier models cannot stream the THETA over
a USB cable.</li>
</ul>
<h3 id="seeing-version-of-ubuntu">Seeing Version of Ubuntu</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>lsb_release -a
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>No LSB modules are available.
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>Distributor ID: Ubuntu
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>Description:    Ubuntu 20.04.6 LTS
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>Release:    20.04
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>Codename:   focal
</span></code></pre></div>
<h3 id="getting-vesion-of-linux-tegra">Getting Vesion of Linux Tegra</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>cat /etc/nv_tegra_release 
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a># R32 (release), REVISION: 7.1
</span></code></pre></div>
<h3 id="mtp-software">MTP software</h3>
<p>This document covers two different strategies:</p>
<ol>
<li>gphoto2 - command line and Python bindings to library</li>
<li>libptp2 - either as library or with command line ptpcam</li>
</ol>
<p>As of July 2023, the most common approach is to use libgphoto2 with gphoto.
Up until 2021, we were primarily using ptpcam, the command line interface to
libptp2.</p>
<p>You can put ptpcam and gphoto2 in a bash
shell script or run a system process from the language
you are using. For example, in Python, you can use the 
<a href="https://docs.python.org/3/library/subprocess.html">subprocess</a> module.</p>
<p>In Dart, you can use the <a href="https://api.dart.dev/stable/3.0.5/dart-io/Process-class.html">Process class</a>. I am using the <a href="https://pub.dev/packages/process_run">process_run</a> package.</p>
<p>As a demonstration of the USB API, I put a GUI wrapper around ptpcam
using Flutter and Dart.</p>
<p><img alt="usb api flutter" src="../images/usb_api/usb_api_flutter_1.gif" /></p>
<p>The next demo shows a common use of putting the camera to sleep
and waking it up.</p>
<p><img alt="usb" src="../images/usb_api/sleep.gif" /></p>
<p>There are several workarounds and fixes that we're using.
Feel free to ask questions.</p>
<h3 id="mtp-bindings">MTP bindings</h3>
<p>You can also use <a href="https://github.com/jim-easterbrook/python-gphoto2/tree/main">python-gphoto2</a>
or other projects to access MTP libraries from inside of
the language you are using.  Python is the most common language.  People also use bash.</p>
<h2 id="libptp-and-ptpcam">libptp and ptpcam</h2>
<p><a href="http://libptp.sourceforge.net/">libptp2</a> builds on <a href="https://github.com/libusb/libusb">libusb</a>. The latest version is 2-1.2.0, which was last updated on 2016-01-12.</p>
<p>The package builds against an older version of libusb, not the current
version that ships with Ubuntu and Raspian.  To get around this, you can
either install an older version of libusb from source or install
<a href="https://github.com/libusb/libusb-compat-0.1">libusb-compat-0.1</a> in addition
to libusb-1xx-dev. </p>
<p>Do not install libusb-compat-0.1 and libusb-0.1x on the same system.  Certain Linux distributions such
as ArchLinux/Manjaro have <a href="https://www.archlinux.org/packages/extra/x86_64/libusb-compat/">packages for libusb-compat</a>.</p>
<p>For Ubuntu 20.04 and 18.04 (JetPack 4.4), I was able to build the package
with libusb-dev.</p>
<p>For Raspian 10 buster, I used the source code for libusb-compat.</p>
<p>As there are many steps and possible places where you may get stuck
feel free to post a question in our 
<a href="https://community.theta360.guide/t/live-streaming-over-usb-on-ubuntu-and-linux-nvidia-jetson/4359?u=craig">forum</a>.</p>
<h3 id="download-libptp-source">Download libptp source</h3>
<p><a href="https://sourceforge.net/projects/libptp/">libptp - Picture Transfer Protocol lib</a></p>
<p>Get the newest version, which is 2-1.2 right now.</p>
<p><img alt="libptp source download" src="../images/usb_api/01_sourceforge_download.png" /></p>
<h3 id="build-libptp">build libptp</h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>$<span class="w"> </span>./configure
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>$<span class="w"> </span>make
</span></code></pre></div>
<p>If you have a build error when compiling libusb, you may need to install the 
development libraries for libusb.</p>
<p><img alt="libptp configuration error" src="../images/usb_api/02_libptp_configure_error.png" /></p>
<h3 id="install-libusb-dev">install libusb-dev</h3>
<p>For Ubuntu 18.04, 20.04 on x86 and JetPack 4.4 on Nano.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>$<span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>libusb-dev
</span></code></pre></div>
<p>You may not need this step if you already have the libusb development
libraries installed.</p>
<p><img alt="libusb-dev install" src="../images/usb_api/03_libusb-dev_install.png" /></p>
<p>Example on x86 Ubuntu 20.04. </p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>$ sudo apt-get install libusb-dev
</span></code></pre></div>
<h4 id="for-raspberry-pi">For Raspberry Pi</h4>
<p>Version.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>Distributor ID: Raspbian
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>Description:    Raspbian GNU/Linux 10 (buster)
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>Release:    10
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>Codename:   buster
</span></code></pre></div>
<p>Get the libusb compatibility layer.</p>
<p><img alt="libusb-compat" src="../images/usb_api/libusb_compat.png" /></p>
<p><img alt="libusb-compat 0.15" src="../images/usb_api/libusb_compat_0.15.png" /></p>
<h3 id="install-libptp">install libptp</h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>$<span class="w"> </span>sudo<span class="w"> </span>make<span class="w"> </span>install
</span></code></pre></div>
<p><img alt="confirm build" src="../images/usb_api/04_build_succeeded.png" /></p>
<p>On x86 Ubuntu 20.04.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>$ tar zxvf libptp2-1.2.0.tar.gz 
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>libptp2-1.2.0/
</span></code></pre></div>
<p><code>./configure</code> ran with no problems<br />
<code>make</code> ran with no problems<br />
<code>sudo make install</code> ran with no problems  </p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>$ pwd
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>/usr/local/lib
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>$ ls -l libptp2.*
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>-rw-r--r-- 1 root root 352640 Aug 31 11:54 libptp2.a
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>-rwxr-xr-x 1 root root    941 Aug 31 11:54 libptp2.la
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>lrwxrwxrwx 1 root root     16 Aug 31 11:54 libptp2.so -&gt; libptp2.so.1.1.5
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>lrwxrwxrwx 1 root root     16 Aug 31 11:54 libptp2.so.1 -&gt; libptp2.so.1.1.5
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>-rwxr-xr-x 1 root root 249352 Aug 31 11:54 libptp2.so.1.1.5
</span></code></pre></div>
<h3 id="set-usrlocallib-in-library-path">set /usr/local/lib in library path</h3>
<p>The default location of the libptp install is <code>/usr/local/lib</code>.<br />
Make sure that this is in your library path.  If it isn't,
add it to a file such as <code>libc.conf</code> in <code>/etc/ld.so.conf/</code>.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>$ cd /etc/ld.so.conf.d/
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>$ ls
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>$ cat libc.conf
</span></code></pre></div>
<p><img alt="library path" src="../images/usb_api/05_confirm_usr_local.png" /></p>
<h3 id="run-ldconfig">run ldconfig</h3>
<p>Load the library configuration.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>$ sudo /sbin/ldconfig -v
</span></code></pre></div>
<p><img alt="ldconfig" src="../images/usb_api/06_ldconfig.png" /></p>
<p>On x86 Ubuntu 20.04.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>$ cd /etc/ld.so.conf.d/
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>$ l
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>fakeroot-x86_64-linux-gnu.conf  x86_64-linux-gnu.conf
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>i386-linux-gnu.conf             zz_i386-biarch-compat.conf
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>libc.conf
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>$ cat libc.conf 
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a># libc default configuration
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>/usr/local/lib
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>$ sudo ldconfig
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>$ 
</span></code></pre></div>
<h3 id="test-ptpcam">Test ptpcam</h3>
<p>Connect RICOH THETA to Jetson with a USB cable.</p>
<p>Version of 2-1.2 of libptp has a bug in it.  Although
ptpcam does take pictures and function normally,
you will
see an error about capture status.</p>
<p><img alt="capture status" src="../images/usb_api/07_capture_status_error.png" /></p>
<p>On x86 Ubuntu.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>$ ptpcam --info
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>Camera information
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>==================
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>Model: RICOH THETA Z1
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>  manufacturer: Ricoh Company, Ltd.
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>  serial number: &#39;10010104&#39;
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>  device version: 1.50.1
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>  extension ID: 0x00000006
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>  extension description: (null)
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>  extension version: 0x006e
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>$ cat /proc/cpuinfo 
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>processor   : 0
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>vendor_id   : GenuineIntel
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>cpu family  : 6
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a>model       : 60
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a>model name  : Intel(R) Pentium(R) CPU G3258 @ 3.20GHz
</span></code></pre></div>
<h3 id="fix-problem-with-libptp-response">Fix problem with libptp response</h3>
<p>Go to line 77 of <code>ptp.h</code> and change <code>PTP_USB_INT_PACKET_LEN</code> 
to <code>28</code>.</p>
<p><img alt="edit libptp source" src="../images/usb_api/08_edit_libptp_source.png" /></p>
<p>After modification, the code will look like this.</p>
<p><img alt="fixed source" src="../images/usb_api/09_libptp_source_fix.png" /></p>
<h2 id="using-usb-api-with-ptpcam-libptp">Using USB API with ptpcam (libptp)</h2>
<h3 id="test-ptpcam-response-again">test ptpcam response again</h3>
<p>Take a still image picture with <code>ptpcam --capture</code>.</p>
<p><img alt="results after fix" src="../images/usb_api/10_fix_results.png" /></p>
<h3 id="set-camera-to-live-streaming-mode">Set camera to live streaming mode</h3>
<p>Check on camera mode.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>$ ptpcam --show-property=0x5013
</span></code></pre></div>
<p>Set to live streaming mode.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>$ ptpcam --set-property=0x5013 --val=0x8005
</span></code></pre></div>
<p><img alt="set to live streaming mode" src="../images/usb_api/11_change_to_live_stream.png" /></p>
<p>Using the official 
<a href="https://github.com/ricohapi/theta-api-specs/blob/main/theta-usb-api/property/still_capture_mode.md">RICOH USB API documentation</a>, you can verify that
<code>0x8005</code> is live streaming mode.  The camera LED should show that
the THETA is in LIVE mode.</p>
<p><img alt="live led v" src="../images/usb_api/live_led.png" /></p>
<p>In our tests, the RICOH THETA Z1 could charge while streaming
over a USB 3.0 port (blue insert).  </p>
<p>After hours of streaming, the Z1 LED looks like this.</p>
<p><img alt="live led z1" src="../images/usb_api/live_z1.jpeg" /></p>
<p>The response codes are shown below.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>    0x0001 = single-shot shooting
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>    0x0003 = Interval shooting
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>    0x8002 = Movie shooting
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>    0x8003 = Interval composite shooting
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>    0x8004 = Multi bracket shooting
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>    0x8005 = Live streaming
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>    0x8006 = Interval shooting - tripod stabilizatio is off 
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>             (top/bottom correction and stitching optimized)
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>    0x8007 = Interval shooting - tripod stabilization is on
</span></code></pre></div>
<p>If you set the camera back to still image, single shot mode,
you will see this response.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>$<span class="w"> </span>ptpcam<span class="w"> </span>--set-property<span class="o">=</span>0x5013<span class="w"> </span>--val<span class="o">=</span>0x0001
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>Camera:<span class="w"> </span>RICOH<span class="w"> </span>THETA<span class="w"> </span>V
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="s1">&#39;Still Capture Mode&#39;</span><span class="w"> </span>is<span class="w"> </span><span class="nb">set</span><span class="w"> </span>to:<span class="w"> </span>0x8005<span class="w"> </span><span class="o">(</span>-32763<span class="o">)</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>Changing<span class="w"> </span>property<span class="w"> </span>value<span class="w"> </span>to<span class="w"> </span>0x0001<span class="w"> </span><span class="o">[(</span>null<span class="o">)]</span><span class="w"> </span>succeeded.
</span></code></pre></div>
<h3 id="wake-camera-from-sleep">Wake Camera From Sleep</h3>
<p>In this test, I have the Z1 power off disabled.  I left the camera
in sleep mode overnight.  When I woke up in the morning,
I woke the Z1 up using an ssh session into the Jetson Nano and 
running this command.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>$<span class="w"> </span>ptpcam<span class="w"> </span>--set-property<span class="o">=</span>0xD80E<span class="w"> </span>--val<span class="o">=</span>0x00
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>Camera:<span class="w"> </span>RICOH<span class="w"> </span>THETA<span class="w"> </span>Z1
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="s1">&#39;UNKNOWN&#39;</span><span class="w"> </span>is<span class="w"> </span><span class="nb">set</span><span class="w"> </span>to:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>Changing<span class="w"> </span>property<span class="w"> </span>value<span class="w"> </span>to<span class="w"> </span>0x00<span class="w"> </span><span class="o">[(</span>null<span class="o">)]</span><span class="w"> </span>succeeded.
</span></code></pre></div>
<p>I tested the camera with the info command.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>$<span class="w"> </span>ptpcam<span class="w"> </span>--info
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>Camera<span class="w"> </span><span class="nv">information</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="o">==================</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>Model:<span class="w"> </span>RICOH<span class="w"> </span>THETA<span class="w"> </span>Z1
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="w">  </span>manufacturer:<span class="w"> </span>Ricoh<span class="w"> </span>Company,<span class="w"> </span>Ltd.
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="w">  </span>serial<span class="w"> </span>number:<span class="w"> </span><span class="s1">&#39;10010104&#39;</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="w">  </span>device<span class="w"> </span>version:<span class="w"> </span><span class="m">1</span>.50.1
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="w">  </span>extension<span class="w"> </span>ID:<span class="w"> </span>0x00000006
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="w">  </span>extension<span class="w"> </span>description:<span class="w"> </span><span class="o">(</span>null<span class="o">)</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="w">  </span>extension<span class="w"> </span>version:<span class="w"> </span>0x006e
</span></code></pre></div>
<p>In my initial tests, I had to run the <code>info</code> command twice after
I woke the camera up from sleep. The first time, I could not
open the session.</p>
<p>I got this error.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>$<span class="w"> </span>ptpcam<span class="w"> </span>--info
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>ERROR:<span class="w"> </span>Could<span class="w"> </span>not<span class="w"> </span>open<span class="w"> </span>session!
</span></code></pre></div>
<p>In the future, I'll run more tests using the
camera <a href="https://github.com/ricohapi/theta-api-specs/blob/main/theta-usb-api/property/functional_mode.md">FunctionalMode</a>
to check status.</p>
<p>This is another example with x86.  Initially, the camera is asleep.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>craig@cube:~$ ptpcam --info
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>Camera information
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>==================
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>ERROR: Could not open session!
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>craig@cube:~$ ptpcam --info
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>Camera information
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>==================
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>Model: RICOH THETA Z1
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>  manufacturer: Ricoh Company, Ltd.
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>  serial number: &#39;10010104&#39;
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a>  device version: 1.50.1
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>  extension ID: 0x00000006
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a>  extension description: (null)
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a>  extension version: 0x006e
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a>craig@cube:~$ ptpcam --set-property=0xd80e --val=0
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a>
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a>Camera: RICOH THETA Z1
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a>&#39;UNKNOWN&#39; is set to: 1
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a>Changing property value to 0 [(null)] succeeded.
</span></code></pre></div>
<p>At this point, the camera is awake.</p>
<h3 id="put-camera-to-sleep">Put camera to sleep</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>$ ptpcam --set-property=0xd80e --val=0x01
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>Camera: RICOH THETA Z1
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>&#39;UNKNOWN&#39; is set to: 0
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>Changing property value to 0x01 [(null)] succeeded.
</span></code></pre></div>
<p>The camera is asleep.</p>
<h3 id="auto-power-off-delay">Auto Power Off Delay</h3>
<p>Disable auto power off.</p>
<p>$ ptpcam --set-property=0xd81b=0</p>
<p>Camera: RICOH THETA Z1
'UNKNOWN' is set to: 0</p>
<p>Verify that auto power off is disabled.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>$ ptpcam --show-property=0xd81b
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>Camera: RICOH THETA Z1
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>&#39;UNKNOWN&#39; is set to: 0
</span></code></pre></div>
<h3 id="shutdown-camera">Shutdown Camera</h3>
<p>This will completely power off the camera and put into lowest battery mode.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>$ ptpcam -R 0x1013
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>Camera: RICOH THETA Z1
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>Sending generic request: reqCode=0x1013, params=[0x00000000,0x00000000,0x00000000,0x00000000,0x00000000]
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>PTP: I/O error
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>ERROR: Could not close session!
</span></code></pre></div>
<p>To turn the camera back on, you must disconnect and then reconnect
the USB cable of the camera.  You can also replicate this process
in software.</p>
<h3 id="put-camera-in-still-image-mode">Put Camera in Still Image Mode</h3>
<p>You may want to take a detailed picture of the scene based on triggers
from the live stream.</p>
<p>To do this, you need to take the camera out of live streaming mode
and put it into still image mode.  In the example below, I
wrapped ptpcam in a script that explains the hexcode properties
of the mode settings.  This helps me with testing.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>$ ptpcam --set-property=0x5013 --val=0x0001
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>Camera: RICOH THETA Z1
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>&#39;Still Capture Mode&#39; is set to: [Normal]
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>Changing property value to 0x0001 [(null)] succeeded.
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>    0x0001 = single-shot shooting
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>    0x0003 = Interval shooting
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>    0x8002 = Movie shooting
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>    0x8003 = Interval composite shooting
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a>    0x8004 = Multi bracket shooting
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a>    0x8005 = Live streaming
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a>    0x8006 = Interval shooting - tripod stabilizatio is off 
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a>             (top/bottom correction and stitching optimized)
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a>    0x8007 = Interval shooting - tripod stabilization is on
</span></code></pre></div>
<p>You can verify the mode of with 0x5013.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>$ ptpcam --show-property=0x5013
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>Camera: RICOH THETA Z1
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>&#39;Still Capture Mode&#39; is set to: [Normal]
</span></code></pre></div>
<p>Compare this with the result when the camera is in live streaming
mode.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>$ ptpcam --show-property=0x5013
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>Camera: RICOH THETA Z1
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>&#39;Still Capture Mode&#39; is set to: 0x8005 (-32763)
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>    0x0001 = single-shot shooting
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>    0x0003 = Interval shooting
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>    0x8002 = Movie shooting
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>    0x8003 = Interval composite shooting
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>    0x8004 = Multi bracket shooting
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>    0x8005 = Live streaming
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>    0x8006 = Interval shooting - tripod stabilizatio is off 
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>             (top/bottom correction and stitching optimized)
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a>    0x8007 = Interval shooting - tripod stabilization is on
</span></code></pre></div>
<h3 id="start-video-capture">Start Video Capture</h3>
<p>This records video to file. </p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>ptpcam -R 0x101c,0,0,1
</span></code></pre></div>
<h3 id="using-raw-ptp-commands">Using Raw PTP Commands</h3>
<p>Get camera <a href="https://github.com/ricohapi/theta-api-specs/blob/main/theta-usb-api/operation/get_device_info.md">info</a>. </p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>$ ptpcam -R 0x1001
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>Camera: RICOH THETA Z1
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>Sending generic request: reqCode=0x1001, params=[0x00000000,0x00000000,0x00000000,0x00000000,0x00000000]
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>64 00 06 00 00 00 6e 00 00 00 00 33 00 00 00 01 - d.....n....3....
</span></code></pre></div>
<h2 id="using-multiple-cameras-with-ptpcam">Using Multiple Cameras with ptpcam</h2>
<h3 id="test-environment">Test Environment</h3>
<ul>
<li>Ubuntu 20.04 on x86</li>
<li>libptp and ptpcam.  compiled from source with patches.  v 2-1.2.0  (assuming you have this working.  If not please post again)</li>
<li>Camera with dev id 42 is Z1 with firmware 1.50.1</li>
<li>camera with dev id 41 is V with fimrware 3.40.1</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>craig@cube:~$ ptpcam --list-devices
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>Listing devices...
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>bus/dev vendorID/prodID device model
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>003/042 0x05CA/0x036D   RICOH THETA Z1
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>003/041 0x05CA/0x2714   RICOH THETA V
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a>$ ptpcam --dev=042 --info
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a>Camera information
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a>==================
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a>Model: RICOH THETA Z1
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a>  manufacturer: Ricoh Company, Ltd.
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a>  serial number: &#39;10010104&#39;
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a>  device version: 1.50.1
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a>  extension ID: 0x00000006
</span><span id="__span-29-17"><a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a>  extension description: (null)
</span><span id="__span-29-18"><a id="__codelineno-29-18" name="__codelineno-29-18" href="#__codelineno-29-18"></a>  extension version: 0x006e
</span><span id="__span-29-19"><a id="__codelineno-29-19" name="__codelineno-29-19" href="#__codelineno-29-19"></a>
</span><span id="__span-29-20"><a id="__codelineno-29-20" name="__codelineno-29-20" href="#__codelineno-29-20"></a>craig@cube:~$ ptpcam --dev=041 --info
</span><span id="__span-29-21"><a id="__codelineno-29-21" name="__codelineno-29-21" href="#__codelineno-29-21"></a>
</span><span id="__span-29-22"><a id="__codelineno-29-22" name="__codelineno-29-22" href="#__codelineno-29-22"></a>Camera information
</span><span id="__span-29-23"><a id="__codelineno-29-23" name="__codelineno-29-23" href="#__codelineno-29-23"></a>==================
</span><span id="__span-29-24"><a id="__codelineno-29-24" name="__codelineno-29-24" href="#__codelineno-29-24"></a>Model: RICOH THETA V
</span><span id="__span-29-25"><a id="__codelineno-29-25" name="__codelineno-29-25" href="#__codelineno-29-25"></a>  manufacturer: Ricoh Company, Ltd.
</span><span id="__span-29-26"><a id="__codelineno-29-26" name="__codelineno-29-26" href="#__codelineno-29-26"></a>  serial number: &#39;00105377&#39;
</span><span id="__span-29-27"><a id="__codelineno-29-27" name="__codelineno-29-27" href="#__codelineno-29-27"></a>  device version: 3.40.1
</span><span id="__span-29-28"><a id="__codelineno-29-28" name="__codelineno-29-28" href="#__codelineno-29-28"></a>  extension ID: 0x00000006
</span><span id="__span-29-29"><a id="__codelineno-29-29" name="__codelineno-29-29" href="#__codelineno-29-29"></a>  extension description: (null)
</span><span id="__span-29-30"><a id="__codelineno-29-30" name="__codelineno-29-30" href="#__codelineno-29-30"></a>  extension version: 0x006e
</span><span id="__span-29-31"><a id="__codelineno-29-31" name="__codelineno-29-31" href="#__codelineno-29-31"></a>
</span><span id="__span-29-32"><a id="__codelineno-29-32" name="__codelineno-29-32" href="#__codelineno-29-32"></a>craig@cube:~$ ptpcam --dev=041 --capture
</span><span id="__span-29-33"><a id="__codelineno-29-33" name="__codelineno-29-33" href="#__codelineno-29-33"></a>
</span><span id="__span-29-34"><a id="__codelineno-29-34" name="__codelineno-29-34" href="#__codelineno-29-34"></a>Initiating captue...
</span><span id="__span-29-35"><a id="__codelineno-29-35" name="__codelineno-29-35" href="#__codelineno-29-35"></a>Object added 0x00000226
</span><span id="__span-29-36"><a id="__codelineno-29-36" name="__codelineno-29-36" href="#__codelineno-29-36"></a>Capture completed successfully!
</span><span id="__span-29-37"><a id="__codelineno-29-37" name="__codelineno-29-37" href="#__codelineno-29-37"></a>craig@cube:~$ ptpcam --dev=042 --capture
</span><span id="__span-29-38"><a id="__codelineno-29-38" name="__codelineno-29-38" href="#__codelineno-29-38"></a>
</span><span id="__span-29-39"><a id="__codelineno-29-39" name="__codelineno-29-39" href="#__codelineno-29-39"></a>Initiating captue...
</span><span id="__span-29-40"><a id="__codelineno-29-40" name="__codelineno-29-40" href="#__codelineno-29-40"></a>Object added 0x00000011
</span><span id="__span-29-41"><a id="__codelineno-29-41" name="__codelineno-29-41" href="#__codelineno-29-41"></a>Capture completed successfully!
</span></code></pre></div>
<p>Slightly more complex, list files:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>~$ ptpcam --dev=042 --list-files
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>Listing files...
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>Camera: RICOH THETA Z1
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>Handler:           Size:    Captured:       name:
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>0x0000000e:      9086912    2019-01-01 08:03    R0010001.JPG
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>0x0000000f:      7968843    2019-01-01 08:00    R0010002.JPG
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>0x00000010:      7990763    2019-01-01 08:01    R0010003.JPG
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>0x00000011:      8008310    2019-01-01 08:03    R0010004.JPG
</span></code></pre></div>
<p>I have several hundred pictures on the V, but it showed it.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>$ ptpcam --dev=041 --list-files
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>Listing files...
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>Camera: RICOH THETA V
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>Handler:           Size:    Captured:       name:
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a>0x00000142:      4152882    2020-06-17 20:59    R0010273.JPG
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>0x00000143:      3979605    2020-06-17 21:03    R0010274.JPG
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a>0x00000147:      4413502    2020-06-17 21:43    R0010277.JPG
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a>...
</span></code></pre></div>
<h3 id="test-with-two-cameras-in-streaming">Test with Two Cameras in Streaming</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>$ ptpcam --dev=041 --set-property=0x5013 --val=0x8005
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>Camera: RICOH THETA V (bus 0, dev 41)
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>&#39;Still Capture Mode&#39; is set to: [Normal]
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>Changing property value to 0x8005 [(null)] succeeded.
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>craig@cube:~$ 
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a>$ ptpcam --dev=042 --set-property=0x5013 --val=0x8005
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a>
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a>Camera: RICOH THETA Z1 (bus 0, dev 42)
</span><span id="__span-32-11"><a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a>&#39;Still Capture Mode&#39; is set to: [Normal]
</span><span id="__span-32-12"><a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a>Changing property value to 0x8005 [(null)] succeeded.
</span></code></pre></div>
<p>At this stage, I now have two cameras streaming into the same devices.  I need to do more tests to manipulate both streams. </p>
<p>however, if your application is handing the stream and image processing already, then you should be good to go.</p>
<h3 id="other-ways-to-grab-device-id">Other Ways to Grab Device ID</h3>
<p>You can also grab the device ID with <code>lsusb</code> or libusb.</p>
<p><img alt="lsusb" src="../images/usb_api/lsusb.png" /></p>
<p>Compare the device IDs to <code>ptpcam --list-devices</code>.  The IDs should be the same.</p>
<p><img alt="list devices" src="../images/usb_api/list_devices.png" /></p>
<h2 id="gphoto2">gphoto2</h2>
<h3 id="command-line">Command Line</h3>
<h4 id="fixing-command-line-error-could-not-claim-the-usb-device">Fixing Command Line Error - Could not claim the USB device</h4>
<p>You may get this error.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>$<span class="w"> </span>gphoto2<span class="w"> </span>--capture-image
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>***<span class="w"> </span>Error<span class="w"> </span>***<span class="w">              </span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>An<span class="w"> </span>error<span class="w"> </span>occurred<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>io-library<span class="w"> </span><span class="o">(</span><span class="s1">&#39;Could not claim the USB device&#39;</span><span class="o">)</span>:<span class="w"> </span>Could<span class="w"> </span>not<span class="w"> </span>claim<span class="w"> </span>interface<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">(</span>Device<span class="w"> </span>or<span class="w"> </span>resource<span class="w"> </span>busy<span class="o">)</span>.<span class="w"> </span>Make<span class="w"> </span>sure<span class="w"> </span>no<span class="w"> </span>other<span class="w"> </span>program<span class="w"> </span><span class="o">(</span>gvfs-gphoto2-volume-monitor<span class="o">)</span><span class="w"> </span>or<span class="w"> </span>kernel<span class="w"> </span>module<span class="w"> </span><span class="o">(</span>such<span class="w"> </span>as<span class="w"> </span>sdc2xx,<span class="w"> </span>stv680,<span class="w"> </span>spca50x<span class="o">)</span><span class="w"> </span>is<span class="w"> </span>using<span class="w"> </span>the<span class="w"> </span>device<span class="w"> </span>and<span class="w"> </span>you<span class="w"> </span>have<span class="w"> </span>read/write<span class="w"> </span>access<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>device.
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>ERROR:<span class="w"> </span>Could<span class="w"> </span>not<span class="w"> </span>capture<span class="w"> </span>image.
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a>ERROR:<span class="w"> </span>Could<span class="w"> </span>not<span class="w"> </span>capture.
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>***<span class="w"> </span>Error<span class="w"> </span><span class="o">(</span>-53:<span class="w"> </span><span class="s1">&#39;Could not claim the USB device&#39;</span><span class="o">)</span><span class="w"> </span>***<span class="w">       </span>
</span></code></pre></div>
<p>Fix for current session is to kill gvfs-gphoto2-volume-monitor and gvfsd-gphoto2 spawner.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>$<span class="w"> </span>ps<span class="w"> </span>aux<span class="w"> </span><span class="p">|</span>grep<span class="w"> </span>gvfs
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>...
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>craig<span class="w">       </span><span class="m">2422</span><span class="w">  </span><span class="m">0</span>.0<span class="w">  </span><span class="m">0</span>.0<span class="w"> </span><span class="m">442504</span><span class="w"> </span><span class="m">13528</span><span class="w"> </span>?<span class="w">        </span>Sl<span class="w">   </span><span class="m">08</span>:19<span class="w">   </span><span class="m">0</span>:00<span class="w"> </span>/usr/libexec/gvfsd-gphoto2<span class="w"> </span>--spawner<span class="w"> </span>:1.3<span class="w"> </span>/org/gtk/gvfs/exec_spaw/1
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>...
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>craig<span class="w">       </span><span class="m">1969</span><span class="w">  </span><span class="m">0</span>.0<span class="w">  </span><span class="m">0</span>.0<span class="w"> </span><span class="m">249860</span><span class="w"> </span><span class="m">10032</span><span class="w"> </span>?<span class="w">        </span>Ssl<span class="w">  </span><span class="m">08</span>:19<span class="w">   </span><span class="m">0</span>:00<span class="w"> </span>/usr/libexec/gvfs-gphoto2-volume-monitor
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a>...
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a>$<span class="w"> </span><span class="nb">kill</span><span class="w"> </span><span class="m">2422</span>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a>$<span class="w"> </span><span class="nb">kill</span><span class="w"> </span><span class="m">1969</span>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a>$<span class="w"> </span>gphoto2<span class="w"> </span>--capture-image
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a>New<span class="w"> </span>file<span class="w"> </span>is<span class="w"> </span><span class="k">in</span><span class="w"> </span>location<span class="w"> </span>/store_00020001/DCIM/100RICOH/R0010376.JPG<span class="w"> </span>on<span class="w"> </span>the<span class="w"> </span>camera
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a>$<span class="w"> </span>
</span></code></pre></div>
<h4 id="removing-gvfs-backend-permanently">Removing gvfs-backend permanently</h4>
<p>If you don't mount the THETA as a storage device with gphoto, you can remove gvfs-backend.  This is a workaround for the 
conflict when you use gphoto2 from the command line to talk to the THETA.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>$ sudo apt remove gvfs-backends
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>[sudo] password for craig: 
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>Reading package lists... Done
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>Building dependency tree       
</span></code></pre></div>
<p>Reboot to test. </p>
<p>After reboot. </p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>$ gphoto2 -l
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>There is 1 folder in folder &#39;/&#39;.                                               
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a> - store_00020001
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a>There is 1 folder in folder &#39;/store_00020001&#39;.
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a> - DCIM
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a>There are 2 folders in folder &#39;/store_00020001/DCIM&#39;.
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a> - 100RICOH
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a> - SingleLensShooting
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a>There is 1 folder in folder &#39;/store_00020001/DCIM/100RICOH&#39;.
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a> - HDR07-22_18-13
</span><span id="__span-36-11"><a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a>There are 0 folders in folder &#39;/store_00020001/DCIM/100RICOH/HDR07-22_18-13&#39;.
</span><span id="__span-36-12"><a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a>There are 0 folders in folder &#39;/store_00020001/DCIM/SingleLensShooting&#39;.
</span></code></pre></div>
<p>It works!</p>
<h4 id="check-camera-mode-still-image-video-streaming">Check Camera Mode (still image, video, streaming)</h4>
<p><a href="https://github.com/ricohapi/theta-api-specs/blob/main/theta-usb-api/property/still_capture_mode.md">StillCaptureMode API reference</a></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>$ gphoto2 --get-config=5013
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>Label: Still Capture Mode
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>Readonly: 0
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a>Type: MENU
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a>Current: 1
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a>Choice: 0 1
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a>Choice: 1 3
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a>Choice: 2 32770
</span><span id="__span-37-9"><a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a>Choice: 3 32771
</span><span id="__span-37-10"><a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a>Choice: 4 32772
</span><span id="__span-37-11"><a id="__codelineno-37-11" name="__codelineno-37-11" href="#__codelineno-37-11"></a>Choice: 5 32773
</span><span id="__span-37-12"><a id="__codelineno-37-12" name="__codelineno-37-12" href="#__codelineno-37-12"></a>Choice: 6 32774
</span><span id="__span-37-13"><a id="__codelineno-37-13" name="__codelineno-37-13" href="#__codelineno-37-13"></a>Choice: 7 32775
</span><span id="__span-37-14"><a id="__codelineno-37-14" name="__codelineno-37-14" href="#__codelineno-37-14"></a>END
</span><span id="__span-37-15"><a id="__codelineno-37-15" name="__codelineno-37-15" href="#__codelineno-37-15"></a>craig@craig-desktop:~$
</span></code></pre></div>
<h4 id="unmount-camera">unmount camera</h4>
<p>If the camera is mounted, the commands may not work.</p>
<p><img alt="unmount camera" src="../images/usb_api/unmount.png" /></p>
<h4 id="set-to-video-mode">set to video mode</h4>
<p>Using the <a href="https://github.com/ricohapi/theta-api-specs/blob/main/theta-usb-api/property/still_capture_mode.md">API reference</a>, we can see that video mode is hex <code>0x8002</code> or 32770 in base 10.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>$ gphoto2 --set-config=5013=32770
</span></code></pre></div>
<h4 id="start-video">start video</h4>
<div class="language-text highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>$ gphoto2 --set-config movie=1
</span></code></pre></div>
<h4 id="stop-video">stop video</h4>
<p>this tip contributed by <a href="https://community.theta360.guide/u/Hugues">hugues</a></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>$ gphoto2 --set-config=/main/actions/opcode=0x1018,0xFFFFFFFF
</span></code></pre></div>
<h4 id="start-video-and-stop-after-specified-time">start video and stop after specified time</h4>
<div class="language-text highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>$ gphoto2 --set-config movie=1 --wait-event=2s --set-config movie=0 
</span></code></pre></div>
<h3 id="python-bindings">Python bindings</h3>
<p>From community member <a href="https://community.theta360.guide/u/mhenrie">mhenrie</a></p>
<p><a href="https://community.theta360.guide/t/using-usb-api-mtp-on-macos/4521/9">original post</a></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="sd">USB api for added performance over http</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="sd">Theta api reference:</span>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="sd">https://developers.theta360.com/en/docs/v2/usb_reference/</span>
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a>
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a><span class="sd">Unable to get mtp or ptp to connect to the camera; After some pain was able to get gphoto2 working</span>
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-42-9"><a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a>
</span><span id="__span-42-10"><a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="__span-42-11"><a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a><span class="kn">import</span> <span class="nn">time</span>
</span><span id="__span-42-12"><a id="__codelineno-42-12" name="__codelineno-42-12" href="#__codelineno-42-12"></a>
</span><span id="__span-42-13"><a id="__codelineno-42-13" name="__codelineno-42-13" href="#__codelineno-42-13"></a><span class="kn">import</span> <span class="nn">gphoto2</span> <span class="k">as</span> <span class="nn">gp</span>
</span><span id="__span-42-14"><a id="__codelineno-42-14" name="__codelineno-42-14" href="#__codelineno-42-14"></a>
</span><span id="__span-42-15"><a id="__codelineno-42-15" name="__codelineno-42-15" href="#__codelineno-42-15"></a><span class="c1"># Properties</span>
</span><span id="__span-42-16"><a id="__codelineno-42-16" name="__codelineno-42-16" href="#__codelineno-42-16"></a><span class="n">SHUTTER_SPEED</span> <span class="o">=</span> <span class="s1">&#39;d00f&#39;</span>
</span><span id="__span-42-17"><a id="__codelineno-42-17" name="__codelineno-42-17" href="#__codelineno-42-17"></a><span class="n">EXPOSURE_INDEX</span> <span class="o">=</span> <span class="s1">&#39;500f&#39;</span>
</span><span id="__span-42-18"><a id="__codelineno-42-18" name="__codelineno-42-18" href="#__codelineno-42-18"></a><span class="n">F_NUMBER</span> <span class="o">=</span> <span class="s1">&#39;5007&#39;</span>
</span><span id="__span-42-19"><a id="__codelineno-42-19" name="__codelineno-42-19" href="#__codelineno-42-19"></a><span class="n">AUDIO_VOLUME</span> <span class="o">=</span> <span class="s1">&#39;502c&#39;</span>
</span><span id="__span-42-20"><a id="__codelineno-42-20" name="__codelineno-42-20" href="#__codelineno-42-20"></a><span class="n">COLOR_TEMPERATURE</span> <span class="o">=</span> <span class="s1">&#39;d813&#39;</span>
</span><span id="__span-42-21"><a id="__codelineno-42-21" name="__codelineno-42-21" href="#__codelineno-42-21"></a><span class="n">EXPOSURE_PROGRAM_MODE</span> <span class="o">=</span> <span class="s1">&#39;500e&#39;</span>
</span><span id="__span-42-22"><a id="__codelineno-42-22" name="__codelineno-42-22" href="#__codelineno-42-22"></a>
</span><span id="__span-42-23"><a id="__codelineno-42-23" name="__codelineno-42-23" href="#__codelineno-42-23"></a><span class="c1"># milliseconds</span>
</span><span id="__span-42-24"><a id="__codelineno-42-24" name="__codelineno-42-24" href="#__codelineno-42-24"></a><span class="n">TIMEOUT</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="__span-42-25"><a id="__codelineno-42-25" name="__codelineno-42-25" href="#__codelineno-42-25"></a><span class="n">TIMEOUT_CAPTURE_DNG</span> <span class="o">=</span> <span class="mi">10000</span>
</span><span id="__span-42-26"><a id="__codelineno-42-26" name="__codelineno-42-26" href="#__codelineno-42-26"></a>
</span><span id="__span-42-27"><a id="__codelineno-42-27" name="__codelineno-42-27" href="#__codelineno-42-27"></a>
</span><span id="__span-42-28"><a id="__codelineno-42-28" name="__codelineno-42-28" href="#__codelineno-42-28"></a><span class="k">def</span> <span class="nf">wait_for_event</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT</span><span class="p">,</span> <span class="n">event_type</span><span class="o">=</span><span class="n">gp</span><span class="o">.</span><span class="n">GP_EVENT_TIMEOUT</span><span class="p">):</span>
</span><span id="__span-42-29"><a id="__codelineno-42-29" name="__codelineno-42-29" href="#__codelineno-42-29"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-42-30"><a id="__codelineno-42-30" name="__codelineno-42-30" href="#__codelineno-42-30"></a><span class="sd">    Wait for event_type to to be triggered.</span>
</span><span id="__span-42-31"><a id="__codelineno-42-31" name="__codelineno-42-31" href="#__codelineno-42-31"></a><span class="sd">    :param camera:</span>
</span><span id="__span-42-32"><a id="__codelineno-42-32" name="__codelineno-42-32" href="#__codelineno-42-32"></a><span class="sd">    :param timeout:</span>
</span><span id="__span-42-33"><a id="__codelineno-42-33" name="__codelineno-42-33" href="#__codelineno-42-33"></a><span class="sd">    :param event_type:</span>
</span><span id="__span-42-34"><a id="__codelineno-42-34" name="__codelineno-42-34" href="#__codelineno-42-34"></a><span class="sd">    :return: event_data</span>
</span><span id="__span-42-35"><a id="__codelineno-42-35" name="__codelineno-42-35" href="#__codelineno-42-35"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-42-36"><a id="__codelineno-42-36" name="__codelineno-42-36" href="#__codelineno-42-36"></a>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="__span-42-37"><a id="__codelineno-42-37" name="__codelineno-42-37" href="#__codelineno-42-37"></a>        <span class="n">_event_type</span><span class="p">,</span> <span class="n">event_data</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">wait_for_event</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>
</span><span id="__span-42-38"><a id="__codelineno-42-38" name="__codelineno-42-38" href="#__codelineno-42-38"></a>        <span class="k">if</span> <span class="n">_event_type</span> <span class="o">==</span> <span class="n">gp</span><span class="o">.</span><span class="n">GP_EVENT_TIMEOUT</span><span class="p">:</span>
</span><span id="__span-42-39"><a id="__codelineno-42-39" name="__codelineno-42-39" href="#__codelineno-42-39"></a>            <span class="k">return</span>
</span><span id="__span-42-40"><a id="__codelineno-42-40" name="__codelineno-42-40" href="#__codelineno-42-40"></a>        <span class="k">if</span> <span class="n">_event_type</span> <span class="o">==</span> <span class="n">event_type</span><span class="p">:</span>
</span><span id="__span-42-41"><a id="__codelineno-42-41" name="__codelineno-42-41" href="#__codelineno-42-41"></a>            <span class="k">return</span> <span class="n">event_data</span>
</span><span id="__span-42-42"><a id="__codelineno-42-42" name="__codelineno-42-42" href="#__codelineno-42-42"></a>
</span><span id="__span-42-43"><a id="__codelineno-42-43" name="__codelineno-42-43" href="#__codelineno-42-43"></a>
</span><span id="__span-42-44"><a id="__codelineno-42-44" name="__codelineno-42-44" href="#__codelineno-42-44"></a><span class="k">def</span> <span class="nf">set_config_by_index</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
</span><span id="__span-42-45"><a id="__codelineno-42-45" name="__codelineno-42-45" href="#__codelineno-42-45"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Set config using choice index&quot;&quot;&quot;</span>
</span><span id="__span-42-46"><a id="__codelineno-42-46" name="__codelineno-42-46" href="#__codelineno-42-46"></a>    <span class="n">value</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_choice</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="__span-42-47"><a id="__codelineno-42-47" name="__codelineno-42-47" href="#__codelineno-42-47"></a>    <span class="n">config</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="__span-42-48"><a id="__codelineno-42-48" name="__codelineno-42-48" href="#__codelineno-42-48"></a>
</span><span id="__span-42-49"><a id="__codelineno-42-49" name="__codelineno-42-49" href="#__codelineno-42-49"></a>    <span class="k">return</span> <span class="n">config</span>
</span><span id="__span-42-50"><a id="__codelineno-42-50" name="__codelineno-42-50" href="#__codelineno-42-50"></a>
</span><span id="__span-42-51"><a id="__codelineno-42-51" name="__codelineno-42-51" href="#__codelineno-42-51"></a>
</span><span id="__span-42-52"><a id="__codelineno-42-52" name="__codelineno-42-52" href="#__codelineno-42-52"></a><span class="c1"># def list_files(camera, path=&#39;/&#39;):</span>
</span><span id="__span-42-53"><a id="__codelineno-42-53" name="__codelineno-42-53" href="#__codelineno-42-53"></a><span class="c1">#     result = []</span>
</span><span id="__span-42-54"><a id="__codelineno-42-54" name="__codelineno-42-54" href="#__codelineno-42-54"></a><span class="c1">#     # get files</span>
</span><span id="__span-42-55"><a id="__codelineno-42-55" name="__codelineno-42-55" href="#__codelineno-42-55"></a><span class="c1">#     for name, value in camera.folder_list_files(path):</span>
</span><span id="__span-42-56"><a id="__codelineno-42-56" name="__codelineno-42-56" href="#__codelineno-42-56"></a><span class="c1">#         result.append(os.path.join(path, name))</span>
</span><span id="__span-42-57"><a id="__codelineno-42-57" name="__codelineno-42-57" href="#__codelineno-42-57"></a><span class="c1">#     # read folders</span>
</span><span id="__span-42-58"><a id="__codelineno-42-58" name="__codelineno-42-58" href="#__codelineno-42-58"></a><span class="c1">#     folders = []</span>
</span><span id="__span-42-59"><a id="__codelineno-42-59" name="__codelineno-42-59" href="#__codelineno-42-59"></a><span class="c1">#     for name, value in camera.folder_list_folders(path):</span>
</span><span id="__span-42-60"><a id="__codelineno-42-60" name="__codelineno-42-60" href="#__codelineno-42-60"></a><span class="c1">#         folders.append(name)</span>
</span><span id="__span-42-61"><a id="__codelineno-42-61" name="__codelineno-42-61" href="#__codelineno-42-61"></a><span class="c1">#     # recurse over subfolders</span>
</span><span id="__span-42-62"><a id="__codelineno-42-62" name="__codelineno-42-62" href="#__codelineno-42-62"></a><span class="c1">#     for name in folders:</span>
</span><span id="__span-42-63"><a id="__codelineno-42-63" name="__codelineno-42-63" href="#__codelineno-42-63"></a><span class="c1">#         result.extend(list_files(camera, os.path.join(path, name)))</span>
</span><span id="__span-42-64"><a id="__codelineno-42-64" name="__codelineno-42-64" href="#__codelineno-42-64"></a><span class="c1">#     return result</span>
</span><span id="__span-42-65"><a id="__codelineno-42-65" name="__codelineno-42-65" href="#__codelineno-42-65"></a><span class="c1">#</span>
</span><span id="__span-42-66"><a id="__codelineno-42-66" name="__codelineno-42-66" href="#__codelineno-42-66"></a><span class="c1">#</span>
</span><span id="__span-42-67"><a id="__codelineno-42-67" name="__codelineno-42-67" href="#__codelineno-42-67"></a><span class="c1"># def get_file_info(camera, path):</span>
</span><span id="__span-42-68"><a id="__codelineno-42-68" name="__codelineno-42-68" href="#__codelineno-42-68"></a><span class="c1">#     folder, name = os.path.split(path)</span>
</span><span id="__span-42-69"><a id="__codelineno-42-69" name="__codelineno-42-69" href="#__codelineno-42-69"></a><span class="c1">#     return camera.file_get_info(folder, name)</span>
</span><span id="__span-42-70"><a id="__codelineno-42-70" name="__codelineno-42-70" href="#__codelineno-42-70"></a>
</span><span id="__span-42-71"><a id="__codelineno-42-71" name="__codelineno-42-71" href="#__codelineno-42-71"></a>
</span><span id="__span-42-72"><a id="__codelineno-42-72" name="__codelineno-42-72" href="#__codelineno-42-72"></a><span class="k">class</span> <span class="nc">CameraUsb</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="__span-42-73"><a id="__codelineno-42-73" name="__codelineno-42-73" href="#__codelineno-42-73"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-42-74"><a id="__codelineno-42-74" name="__codelineno-42-74" href="#__codelineno-42-74"></a><span class="sd">    Define API for multiple exposure</span>
</span><span id="__span-42-75"><a id="__codelineno-42-75" name="__codelineno-42-75" href="#__codelineno-42-75"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-42-76"><a id="__codelineno-42-76" name="__codelineno-42-76" href="#__codelineno-42-76"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-42-77"><a id="__codelineno-42-77" name="__codelineno-42-77" href="#__codelineno-42-77"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
</span><span id="__span-42-78"><a id="__codelineno-42-78" name="__codelineno-42-78" href="#__codelineno-42-78"></a>
</span><span id="__span-42-79"><a id="__codelineno-42-79" name="__codelineno-42-79" href="#__codelineno-42-79"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">camera</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">Camera</span><span class="p">()</span>
</span><span id="__span-42-80"><a id="__codelineno-42-80" name="__codelineno-42-80" href="#__codelineno-42-80"></a>
</span><span id="__span-42-81"><a id="__codelineno-42-81" name="__codelineno-42-81" href="#__codelineno-42-81"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">camera_config</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-42-82"><a id="__codelineno-42-82" name="__codelineno-42-82" href="#__codelineno-42-82"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_config</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-42-83"><a id="__codelineno-42-83" name="__codelineno-42-83" href="#__codelineno-42-83"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">other_config</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-42-84"><a id="__codelineno-42-84" name="__codelineno-42-84" href="#__codelineno-42-84"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">shutter_speed_config</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-42-85"><a id="__codelineno-42-85" name="__codelineno-42-85" href="#__codelineno-42-85"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">shutter_speed_options</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-42-86"><a id="__codelineno-42-86" name="__codelineno-42-86" href="#__codelineno-42-86"></a>
</span><span id="__span-42-87"><a id="__codelineno-42-87" name="__codelineno-42-87" href="#__codelineno-42-87"></a>    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-42-88"><a id="__codelineno-42-88" name="__codelineno-42-88" href="#__codelineno-42-88"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-42-89"><a id="__codelineno-42-89" name="__codelineno-42-89" href="#__codelineno-42-89"></a><span class="sd">        Set manual exposure and other defaults</span>
</span><span id="__span-42-90"><a id="__codelineno-42-90" name="__codelineno-42-90" href="#__codelineno-42-90"></a><span class="sd">        :return: config</span>
</span><span id="__span-42-91"><a id="__codelineno-42-91" name="__codelineno-42-91" href="#__codelineno-42-91"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-42-92"><a id="__codelineno-42-92" name="__codelineno-42-92" href="#__codelineno-42-92"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-42-93"><a id="__codelineno-42-93" name="__codelineno-42-93" href="#__codelineno-42-93"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">camera_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
</span><span id="__span-42-94"><a id="__codelineno-42-94" name="__codelineno-42-94" href="#__codelineno-42-94"></a>        <span class="k">except</span> <span class="n">gp</span><span class="o">.</span><span class="n">GPhoto2Error</span><span class="p">:</span>
</span><span id="__span-42-95"><a id="__codelineno-42-95" name="__codelineno-42-95" href="#__codelineno-42-95"></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Unable to connect to Camera&quot;</span><span class="p">)</span>
</span><span id="__span-42-96"><a id="__codelineno-42-96" name="__codelineno-42-96" href="#__codelineno-42-96"></a>
</span><span id="__span-42-97"><a id="__codelineno-42-97" name="__codelineno-42-97" href="#__codelineno-42-97"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">other_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera_config</span><span class="o">.</span><span class="n">get_child_by_name</span><span class="p">(</span><span class="s1">&#39;other&#39;</span><span class="p">)</span>
</span><span id="__span-42-98"><a id="__codelineno-42-98" name="__codelineno-42-98" href="#__codelineno-42-98"></a>
</span><span id="__span-42-99"><a id="__codelineno-42-99" name="__codelineno-42-99" href="#__codelineno-42-99"></a>        <span class="c1"># Manual/f-stop/iso</span>
</span><span id="__span-42-100"><a id="__codelineno-42-100" name="__codelineno-42-100" href="#__codelineno-42-100"></a>        <span class="n">exposure_program_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">other_config</span><span class="o">.</span><span class="n">get_child_by_name</span><span class="p">(</span><span class="n">EXPOSURE_PROGRAM_MODE</span><span class="p">)</span>
</span><span id="__span-42-101"><a id="__codelineno-42-101" name="__codelineno-42-101" href="#__codelineno-42-101"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">exposure_program_mode</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
</span><span id="__span-42-102"><a id="__codelineno-42-102" name="__codelineno-42-102" href="#__codelineno-42-102"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Setting camera to Manual exposure program&#39;</span><span class="p">)</span>
</span><span id="__span-42-103"><a id="__codelineno-42-103" name="__codelineno-42-103" href="#__codelineno-42-103"></a>            <span class="n">exposure_program_mode</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
</span><span id="__span-42-104"><a id="__codelineno-42-104" name="__codelineno-42-104" href="#__codelineno-42-104"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">camera_config</span><span class="p">)</span>
</span><span id="__span-42-105"><a id="__codelineno-42-105" name="__codelineno-42-105" href="#__codelineno-42-105"></a>            <span class="n">wait_for_event</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">)</span>
</span><span id="__span-42-106"><a id="__codelineno-42-106" name="__codelineno-42-106" href="#__codelineno-42-106"></a>
</span><span id="__span-42-107"><a id="__codelineno-42-107" name="__codelineno-42-107" href="#__codelineno-42-107"></a>            <span class="c1"># When switching exposure program, we need to refresh the configs</span>
</span><span id="__span-42-108"><a id="__codelineno-42-108" name="__codelineno-42-108" href="#__codelineno-42-108"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">camera_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
</span><span id="__span-42-109"><a id="__codelineno-42-109" name="__codelineno-42-109" href="#__codelineno-42-109"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">other_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera_config</span><span class="o">.</span><span class="n">get_child_by_name</span><span class="p">(</span><span class="s1">&#39;other&#39;</span><span class="p">)</span>
</span><span id="__span-42-110"><a id="__codelineno-42-110" name="__codelineno-42-110" href="#__codelineno-42-110"></a>
</span><span id="__span-42-111"><a id="__codelineno-42-111" name="__codelineno-42-111" href="#__codelineno-42-111"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera_config</span><span class="o">.</span><span class="n">get_child_by_name</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span>
</span><span id="__span-42-112"><a id="__codelineno-42-112" name="__codelineno-42-112" href="#__codelineno-42-112"></a>
</span><span id="__span-42-113"><a id="__codelineno-42-113" name="__codelineno-42-113" href="#__codelineno-42-113"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">shutter_speed_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">other_config</span><span class="o">.</span><span class="n">get_child_by_name</span><span class="p">(</span><span class="n">SHUTTER_SPEED</span><span class="p">)</span>
</span><span id="__span-42-114"><a id="__codelineno-42-114" name="__codelineno-42-114" href="#__codelineno-42-114"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">shutter_speed_options</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shutter_speed_config</span><span class="o">.</span><span class="n">get_choices</span><span class="p">()]</span>
</span><span id="__span-42-115"><a id="__codelineno-42-115" name="__codelineno-42-115" href="#__codelineno-42-115"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shutter_speed_options</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">61</span><span class="p">:</span>
</span><span id="__span-42-116"><a id="__codelineno-42-116" name="__codelineno-42-116" href="#__codelineno-42-116"></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Unble to determine shutter speed options; restart app&#39;</span><span class="p">)</span>
</span><span id="__span-42-117"><a id="__codelineno-42-117" name="__codelineno-42-117" href="#__codelineno-42-117"></a>
</span><span id="__span-42-118"><a id="__codelineno-42-118" name="__codelineno-42-118" href="#__codelineno-42-118"></a>        <span class="n">fstop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">other_config</span><span class="o">.</span><span class="n">get_child_by_name</span><span class="p">(</span><span class="n">F_NUMBER</span><span class="p">)</span>
</span><span id="__span-42-119"><a id="__codelineno-42-119" name="__codelineno-42-119" href="#__codelineno-42-119"></a>        <span class="n">fstop</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s1">&#39;560&#39;</span><span class="p">)</span>
</span><span id="__span-42-120"><a id="__codelineno-42-120" name="__codelineno-42-120" href="#__codelineno-42-120"></a>
</span><span id="__span-42-121"><a id="__codelineno-42-121" name="__codelineno-42-121" href="#__codelineno-42-121"></a>        <span class="n">iso</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">other_config</span><span class="o">.</span><span class="n">get_child_by_name</span><span class="p">(</span><span class="n">EXPOSURE_INDEX</span><span class="p">)</span>
</span><span id="__span-42-122"><a id="__codelineno-42-122" name="__codelineno-42-122" href="#__codelineno-42-122"></a>        <span class="n">iso</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s1">&#39;80&#39;</span><span class="p">)</span>
</span><span id="__span-42-123"><a id="__codelineno-42-123" name="__codelineno-42-123" href="#__codelineno-42-123"></a>
</span><span id="__span-42-124"><a id="__codelineno-42-124" name="__codelineno-42-124" href="#__codelineno-42-124"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">camera_config</span><span class="p">)</span>
</span><span id="__span-42-125"><a id="__codelineno-42-125" name="__codelineno-42-125" href="#__codelineno-42-125"></a>        <span class="n">wait_for_event</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">)</span>
</span><span id="__span-42-126"><a id="__codelineno-42-126" name="__codelineno-42-126" href="#__codelineno-42-126"></a>
</span><span id="__span-42-127"><a id="__codelineno-42-127" name="__codelineno-42-127" href="#__codelineno-42-127"></a>    <span class="k">def</span> <span class="nf">get_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-42-128"><a id="__codelineno-42-128" name="__codelineno-42-128" href="#__codelineno-42-128"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-42-129"><a id="__codelineno-42-129" name="__codelineno-42-129" href="#__codelineno-42-129"></a><span class="sd">        :return: Dict containing serialnumber, batterylevel, remainingpictures, etc</span>
</span><span id="__span-42-130"><a id="__codelineno-42-130" name="__codelineno-42-130" href="#__codelineno-42-130"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-42-131"><a id="__codelineno-42-131" name="__codelineno-42-131" href="#__codelineno-42-131"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera_config</span><span class="p">:</span>
</span><span id="__span-42-132"><a id="__codelineno-42-132" name="__codelineno-42-132" href="#__codelineno-42-132"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
</span><span id="__span-42-133"><a id="__codelineno-42-133" name="__codelineno-42-133" href="#__codelineno-42-133"></a>
</span><span id="__span-42-134"><a id="__codelineno-42-134" name="__codelineno-42-134" href="#__codelineno-42-134"></a>        <span class="n">battery_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_config</span><span class="o">.</span><span class="n">get_child_by_name</span><span class="p">(</span><span class="s1">&#39;batterylevel&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
</span><span id="__span-42-135"><a id="__codelineno-42-135" name="__codelineno-42-135" href="#__codelineno-42-135"></a>        <span class="c1"># Convert &#39;67%&#39; to int</span>
</span><span id="__span-42-136"><a id="__codelineno-42-136" name="__codelineno-42-136" href="#__codelineno-42-136"></a>        <span class="n">battery_level</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">battery_level</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()]))</span>
</span><span id="__span-42-137"><a id="__codelineno-42-137" name="__codelineno-42-137" href="#__codelineno-42-137"></a>
</span><span id="__span-42-138"><a id="__codelineno-42-138" name="__codelineno-42-138" href="#__codelineno-42-138"></a>        <span class="n">info</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;serialnumber&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_config</span><span class="o">.</span><span class="n">get_child_by_name</span><span class="p">(</span><span class="s1">&#39;serialnumber&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_value</span><span class="p">(),</span>
</span><span id="__span-42-139"><a id="__codelineno-42-139" name="__codelineno-42-139" href="#__codelineno-42-139"></a>                <span class="s1">&#39;cameramodel&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_config</span><span class="o">.</span><span class="n">get_child_by_name</span><span class="p">(</span><span class="s1">&#39;cameramodel&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_value</span><span class="p">(),</span>
</span><span id="__span-42-140"><a id="__codelineno-42-140" name="__codelineno-42-140" href="#__codelineno-42-140"></a>                <span class="s1">&#39;deviceversion&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_config</span><span class="o">.</span><span class="n">get_child_by_name</span><span class="p">(</span><span class="s1">&#39;deviceversion&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_value</span><span class="p">(),</span>
</span><span id="__span-42-141"><a id="__codelineno-42-141" name="__codelineno-42-141" href="#__codelineno-42-141"></a>                <span class="s1">&#39;batterylevel&#39;</span><span class="p">:</span> <span class="n">battery_level</span><span class="p">,</span>
</span><span id="__span-42-142"><a id="__codelineno-42-142" name="__codelineno-42-142" href="#__codelineno-42-142"></a>                <span class="s1">&#39;remainingpictures&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">get_storageinfo</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">freeimages</span><span class="p">)}</span>
</span><span id="__span-42-143"><a id="__codelineno-42-143" name="__codelineno-42-143" href="#__codelineno-42-143"></a>        <span class="k">return</span> <span class="n">info</span>
</span><span id="__span-42-144"><a id="__codelineno-42-144" name="__codelineno-42-144" href="#__codelineno-42-144"></a>
</span><span id="__span-42-145"><a id="__codelineno-42-145" name="__codelineno-42-145" href="#__codelineno-42-145"></a>    <span class="k">def</span> <span class="nf">take_picture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shutter_speed_index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color_temperature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">volume</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="__span-42-146"><a id="__codelineno-42-146" name="__codelineno-42-146" href="#__codelineno-42-146"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-42-147"><a id="__codelineno-42-147" name="__codelineno-42-147" href="#__codelineno-42-147"></a><span class="sd">        Set camera options and take picture</span>
</span><span id="__span-42-148"><a id="__codelineno-42-148" name="__codelineno-42-148" href="#__codelineno-42-148"></a><span class="sd">        Blocking</span>
</span><span id="__span-42-149"><a id="__codelineno-42-149" name="__codelineno-42-149" href="#__codelineno-42-149"></a><span class="sd">        :param shutter_speed_index: int in range 0-60 (0 fastest shutter)</span>
</span><span id="__span-42-150"><a id="__codelineno-42-150" name="__codelineno-42-150" href="#__codelineno-42-150"></a><span class="sd">        :param color_temperature: in in range 2500-10000 by 100 increment</span>
</span><span id="__span-42-151"><a id="__codelineno-42-151" name="__codelineno-42-151" href="#__codelineno-42-151"></a><span class="sd">        :param volume: int in range 0-100</span>
</span><span id="__span-42-152"><a id="__codelineno-42-152" name="__codelineno-42-152" href="#__codelineno-42-152"></a><span class="sd">        :return: (jpg_path, dng_path)</span>
</span><span id="__span-42-153"><a id="__codelineno-42-153" name="__codelineno-42-153" href="#__codelineno-42-153"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-42-154"><a id="__codelineno-42-154" name="__codelineno-42-154" href="#__codelineno-42-154"></a>        <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="__span-42-155"><a id="__codelineno-42-155" name="__codelineno-42-155" href="#__codelineno-42-155"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera_config</span><span class="p">:</span>
</span><span id="__span-42-156"><a id="__codelineno-42-156" name="__codelineno-42-156" href="#__codelineno-42-156"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
</span><span id="__span-42-157"><a id="__codelineno-42-157" name="__codelineno-42-157" href="#__codelineno-42-157"></a>
</span><span id="__span-42-158"><a id="__codelineno-42-158" name="__codelineno-42-158" href="#__codelineno-42-158"></a>        <span class="k">if</span> <span class="n">shutter_speed_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-42-159"><a id="__codelineno-42-159" name="__codelineno-42-159" href="#__codelineno-42-159"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">shutter_speed_config</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shutter_speed_options</span><span class="p">[</span><span class="n">shutter_speed_index</span><span class="p">])</span>
</span><span id="__span-42-160"><a id="__codelineno-42-160" name="__codelineno-42-160" href="#__codelineno-42-160"></a>
</span><span id="__span-42-161"><a id="__codelineno-42-161" name="__codelineno-42-161" href="#__codelineno-42-161"></a>        <span class="k">if</span> <span class="n">color_temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-42-162"><a id="__codelineno-42-162" name="__codelineno-42-162" href="#__codelineno-42-162"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">other_config</span><span class="o">.</span><span class="n">get_child_by_name</span><span class="p">(</span><span class="n">COLOR_TEMPERATURE</span><span class="p">)</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">color_temperature</span><span class="p">)</span>
</span><span id="__span-42-163"><a id="__codelineno-42-163" name="__codelineno-42-163" href="#__codelineno-42-163"></a>
</span><span id="__span-42-164"><a id="__codelineno-42-164" name="__codelineno-42-164" href="#__codelineno-42-164"></a>        <span class="k">if</span> <span class="n">volume</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-42-165"><a id="__codelineno-42-165" name="__codelineno-42-165" href="#__codelineno-42-165"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">other_config</span><span class="o">.</span><span class="n">get_child_by_name</span><span class="p">(</span><span class="n">AUDIO_VOLUME</span><span class="p">)</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">volume</span><span class="p">))</span>
</span><span id="__span-42-166"><a id="__codelineno-42-166" name="__codelineno-42-166" href="#__codelineno-42-166"></a>
</span><span id="__span-42-167"><a id="__codelineno-42-167" name="__codelineno-42-167" href="#__codelineno-42-167"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">camera_config</span><span class="p">)</span>
</span><span id="__span-42-168"><a id="__codelineno-42-168" name="__codelineno-42-168" href="#__codelineno-42-168"></a>        <span class="c1"># We need this even though no event is triggered</span>
</span><span id="__span-42-169"><a id="__codelineno-42-169" name="__codelineno-42-169" href="#__codelineno-42-169"></a>        <span class="n">wait_for_event</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">)</span>
</span><span id="__span-42-170"><a id="__codelineno-42-170" name="__codelineno-42-170" href="#__codelineno-42-170"></a>
</span><span id="__span-42-171"><a id="__codelineno-42-171" name="__codelineno-42-171" href="#__codelineno-42-171"></a>        <span class="n">gp_jpg_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">GP_CAPTURE_IMAGE</span><span class="p">)</span>
</span><span id="__span-42-172"><a id="__codelineno-42-172" name="__codelineno-42-172" href="#__codelineno-42-172"></a>
</span><span id="__span-42-173"><a id="__codelineno-42-173" name="__codelineno-42-173" href="#__codelineno-42-173"></a>        <span class="n">gp_dng_path</span> <span class="o">=</span> <span class="n">wait_for_event</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT_CAPTURE_DNG</span><span class="p">,</span> <span class="n">event_type</span><span class="o">=</span><span class="n">gp</span><span class="o">.</span><span class="n">GP_EVENT_FILE_ADDED</span><span class="p">)</span>
</span><span id="__span-42-174"><a id="__codelineno-42-174" name="__codelineno-42-174" href="#__codelineno-42-174"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">gp_dng_path</span><span class="p">:</span>
</span><span id="__span-42-175"><a id="__codelineno-42-175" name="__codelineno-42-175" href="#__codelineno-42-175"></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Unable to copy DNG&#39;</span><span class="p">)</span>
</span><span id="__span-42-176"><a id="__codelineno-42-176" name="__codelineno-42-176" href="#__codelineno-42-176"></a>
</span><span id="__span-42-177"><a id="__codelineno-42-177" name="__codelineno-42-177" href="#__codelineno-42-177"></a>        <span class="n">jpg_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">gp_jpg_path</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="n">gp_jpg_path</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-42-178"><a id="__codelineno-42-178" name="__codelineno-42-178" href="#__codelineno-42-178"></a>        <span class="n">dng_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">gp_dng_path</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span> <span class="n">gp_dng_path</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-42-179"><a id="__codelineno-42-179" name="__codelineno-42-179" href="#__codelineno-42-179"></a>
</span><span id="__span-42-180"><a id="__codelineno-42-180" name="__codelineno-42-180" href="#__codelineno-42-180"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Capture took </span><span class="si">%0.03f</span><span class="s1"> sec&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t1</span><span class="p">,</span> <span class="p">))</span>
</span><span id="__span-42-181"><a id="__codelineno-42-181" name="__codelineno-42-181" href="#__codelineno-42-181"></a>        <span class="k">return</span> <span class="n">jpg_path</span><span class="p">,</span> <span class="n">dng_path</span>
</span><span id="__span-42-182"><a id="__codelineno-42-182" name="__codelineno-42-182" href="#__codelineno-42-182"></a>
</span><span id="__span-42-183"><a id="__codelineno-42-183" name="__codelineno-42-183" href="#__codelineno-42-183"></a>    <span class="k">def</span> <span class="nf">download_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src_path</span><span class="p">,</span> <span class="n">dst_path</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="__span-42-184"><a id="__codelineno-42-184" name="__codelineno-42-184" href="#__codelineno-42-184"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Copy the file from the camera src_path to local dst_path&quot;&quot;&quot;</span>
</span><span id="__span-42-185"><a id="__codelineno-42-185" name="__codelineno-42-185" href="#__codelineno-42-185"></a>        <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="__span-42-186"><a id="__codelineno-42-186" name="__codelineno-42-186" href="#__codelineno-42-186"></a>
</span><span id="__span-42-187"><a id="__codelineno-42-187" name="__codelineno-42-187" href="#__codelineno-42-187"></a>        <span class="n">src_folder</span><span class="p">,</span> <span class="n">src_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">src_path</span><span class="p">)</span>
</span><span id="__span-42-188"><a id="__codelineno-42-188" name="__codelineno-42-188" href="#__codelineno-42-188"></a>        <span class="n">src_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">file_get</span><span class="p">(</span><span class="n">src_folder</span><span class="p">,</span> <span class="n">src_name</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">GP_FILE_TYPE_NORMAL</span><span class="p">)</span>
</span><span id="__span-42-189"><a id="__codelineno-42-189" name="__codelineno-42-189" href="#__codelineno-42-189"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Download </span><span class="si">%s</span><span class="s1"> -&gt;</span><span class="se">\n\t</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">src_path</span><span class="p">,</span> <span class="n">dst_path</span><span class="p">))</span>
</span><span id="__span-42-190"><a id="__codelineno-42-190" name="__codelineno-42-190" href="#__codelineno-42-190"></a>        <span class="n">src_file</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">dst_path</span><span class="p">)</span>
</span><span id="__span-42-191"><a id="__codelineno-42-191" name="__codelineno-42-191" href="#__codelineno-42-191"></a>        <span class="n">wait_for_event</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">)</span>
</span><span id="__span-42-192"><a id="__codelineno-42-192" name="__codelineno-42-192" href="#__codelineno-42-192"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Download took </span><span class="si">%0.03f</span><span class="s1"> sec&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t1</span><span class="p">,</span> <span class="p">))</span>
</span><span id="__span-42-193"><a id="__codelineno-42-193" name="__codelineno-42-193" href="#__codelineno-42-193"></a>
</span><span id="__span-42-194"><a id="__codelineno-42-194" name="__codelineno-42-194" href="#__codelineno-42-194"></a>        <span class="k">if</span> <span class="n">delete</span><span class="p">:</span>
</span><span id="__span-42-195"><a id="__codelineno-42-195" name="__codelineno-42-195" href="#__codelineno-42-195"></a>            <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="__span-42-196"><a id="__codelineno-42-196" name="__codelineno-42-196" href="#__codelineno-42-196"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Delete </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">src_path</span><span class="p">)</span>
</span><span id="__span-42-197"><a id="__codelineno-42-197" name="__codelineno-42-197" href="#__codelineno-42-197"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">file_delete</span><span class="p">(</span><span class="n">src_folder</span><span class="p">,</span> <span class="n">src_name</span><span class="p">)</span>
</span><span id="__span-42-198"><a id="__codelineno-42-198" name="__codelineno-42-198" href="#__codelineno-42-198"></a>            <span class="n">wait_for_event</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">)</span>
</span><span id="__span-42-199"><a id="__codelineno-42-199" name="__codelineno-42-199" href="#__codelineno-42-199"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Delete took </span><span class="si">%0.03f</span><span class="s1"> sec&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t1</span><span class="p">,</span> <span class="p">))</span>
</span><span id="__span-42-200"><a id="__codelineno-42-200" name="__codelineno-42-200" href="#__codelineno-42-200"></a>
</span><span id="__span-42-201"><a id="__codelineno-42-201" name="__codelineno-42-201" href="#__codelineno-42-201"></a>
</span><span id="__span-42-202"><a id="__codelineno-42-202" name="__codelineno-42-202" href="#__codelineno-42-202"></a><span class="k">def</span> <span class="nf">_unittest</span><span class="p">():</span>
</span><span id="__span-42-203"><a id="__codelineno-42-203" name="__codelineno-42-203" href="#__codelineno-42-203"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;test a short exposure sequence&quot;&quot;&quot;</span>
</span><span id="__span-42-204"><a id="__codelineno-42-204" name="__codelineno-42-204" href="#__codelineno-42-204"></a>    <span class="c1"># temporary directory</span>
</span><span id="__span-42-205"><a id="__codelineno-42-205" name="__codelineno-42-205" href="#__codelineno-42-205"></a>    <span class="n">dst_template</span> <span class="o">=</span> <span class="s1">&#39;/tmp/theta/capture.</span><span class="si">%04d</span><span class="s1">.</span><span class="si">%s</span><span class="s1">&#39;</span>
</span><span id="__span-42-206"><a id="__codelineno-42-206" name="__codelineno-42-206" href="#__codelineno-42-206"></a>
</span><span id="__span-42-207"><a id="__codelineno-42-207" name="__codelineno-42-207" href="#__codelineno-42-207"></a>    <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="__span-42-208"><a id="__codelineno-42-208" name="__codelineno-42-208" href="#__codelineno-42-208"></a>    <span class="n">camera</span> <span class="o">=</span> <span class="n">CameraUsb</span><span class="p">()</span>
</span><span id="__span-42-209"><a id="__codelineno-42-209" name="__codelineno-42-209" href="#__codelineno-42-209"></a>
</span><span id="__span-42-210"><a id="__codelineno-42-210" name="__codelineno-42-210" href="#__codelineno-42-210"></a>    <span class="n">camera</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
</span><span id="__span-42-211"><a id="__codelineno-42-211" name="__codelineno-42-211" href="#__codelineno-42-211"></a>
</span><span id="__span-42-212"><a id="__codelineno-42-212" name="__codelineno-42-212" href="#__codelineno-42-212"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">get_info</span><span class="p">())</span>
</span><span id="__span-42-213"><a id="__codelineno-42-213" name="__codelineno-42-213" href="#__codelineno-42-213"></a>
</span><span id="__span-42-214"><a id="__codelineno-42-214" name="__codelineno-42-214" href="#__codelineno-42-214"></a>    <span class="n">frame</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="__span-42-215"><a id="__codelineno-42-215" name="__codelineno-42-215" href="#__codelineno-42-215"></a>    <span class="n">jpg_path</span><span class="p">,</span> <span class="n">dng_path</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">take_picture</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-42-216"><a id="__codelineno-42-216" name="__codelineno-42-216" href="#__codelineno-42-216"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">jpg_path</span><span class="p">,</span> <span class="n">dng_path</span><span class="p">)</span>
</span><span id="__span-42-217"><a id="__codelineno-42-217" name="__codelineno-42-217" href="#__codelineno-42-217"></a>    <span class="n">camera</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span><span class="n">dng_path</span><span class="p">,</span> <span class="n">dst_template</span> <span class="o">%</span> <span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="s1">&#39;dng&#39;</span><span class="p">))</span>
</span><span id="__span-42-218"><a id="__codelineno-42-218" name="__codelineno-42-218" href="#__codelineno-42-218"></a>    <span class="n">frame</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-42-219"><a id="__codelineno-42-219" name="__codelineno-42-219" href="#__codelineno-42-219"></a>
</span><span id="__span-42-220"><a id="__codelineno-42-220" name="__codelineno-42-220" href="#__codelineno-42-220"></a>    <span class="n">jpg_path</span><span class="p">,</span> <span class="n">dng_path</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">take_picture</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
</span><span id="__span-42-221"><a id="__codelineno-42-221" name="__codelineno-42-221" href="#__codelineno-42-221"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">jpg_path</span><span class="p">,</span> <span class="n">dng_path</span><span class="p">)</span>
</span><span id="__span-42-222"><a id="__codelineno-42-222" name="__codelineno-42-222" href="#__codelineno-42-222"></a>    <span class="n">camera</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span><span class="n">dng_path</span><span class="p">,</span> <span class="n">dst_template</span> <span class="o">%</span> <span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="s1">&#39;dng&#39;</span><span class="p">))</span>
</span><span id="__span-42-223"><a id="__codelineno-42-223" name="__codelineno-42-223" href="#__codelineno-42-223"></a>    <span class="n">frame</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-42-224"><a id="__codelineno-42-224" name="__codelineno-42-224" href="#__codelineno-42-224"></a>
</span><span id="__span-42-225"><a id="__codelineno-42-225" name="__codelineno-42-225" href="#__codelineno-42-225"></a>    <span class="n">jpg_path</span><span class="p">,</span> <span class="n">dng_path</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">take_picture</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
</span><span id="__span-42-226"><a id="__codelineno-42-226" name="__codelineno-42-226" href="#__codelineno-42-226"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">jpg_path</span><span class="p">,</span> <span class="n">dng_path</span><span class="p">)</span>
</span><span id="__span-42-227"><a id="__codelineno-42-227" name="__codelineno-42-227" href="#__codelineno-42-227"></a>    <span class="n">camera</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span><span class="n">dng_path</span><span class="p">,</span> <span class="n">dst_template</span> <span class="o">%</span> <span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="s1">&#39;dng&#39;</span><span class="p">))</span>
</span><span id="__span-42-228"><a id="__codelineno-42-228" name="__codelineno-42-228" href="#__codelineno-42-228"></a>    <span class="n">frame</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-42-229"><a id="__codelineno-42-229" name="__codelineno-42-229" href="#__codelineno-42-229"></a>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done in </span><span class="si">%0.03f</span><span class="s1"> sec&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t1</span><span class="p">,</span> <span class="p">))</span>
</span><span id="__span-42-230"><a id="__codelineno-42-230" name="__codelineno-42-230" href="#__codelineno-42-230"></a>
</span><span id="__span-42-231"><a id="__codelineno-42-231" name="__codelineno-42-231" href="#__codelineno-42-231"></a>
</span><span id="__span-42-232"><a id="__codelineno-42-232" name="__codelineno-42-232" href="#__codelineno-42-232"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-42-233"><a id="__codelineno-42-233" name="__codelineno-42-233" href="#__codelineno-42-233"></a>
</span><span id="__span-42-234"><a id="__codelineno-42-234" name="__codelineno-42-234" href="#__codelineno-42-234"></a>    <span class="n">_unittest</span><span class="p">()</span>
</span></code></pre></div>









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/theta360developers" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/theta360dev" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.facebook.com/theta360guide/" target="_blank" rel="noopener" title="www.facebook.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M512 256C512 114.6 397.4 0 256 0S0 114.6 0 256c0 120 82.7 220.8 194.2 248.5V334.2h-52.8V256h52.8v-33.7c0-87.1 39.4-127.5 125-127.5 16.2 0 44.2 3.2 55.7 6.4V172c-6-.6-16.5-1-29.6-1-42 0-58.2 15.9-58.2 57.2V256h83.6l-14.4 78.2H287v175.9C413.8 494.8 512 386.9 512 256z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  </body>
</html>